{"version":3,"file":"index.modern.js","sources":["../src/components/AudioRenderer.tsx","../src/components/ControlButton.tsx","../src/components/AudioSelectButton.tsx","../src/useParticipant.ts","../src/components/VideoSelectButton.tsx","../src/components/ControlsView.tsx","../src/components/DisplayContext.tsx","../src/components/VideoRenderer.tsx","../src/components/ParticipantView.tsx","../src/components/ScreenShareView.tsx","../src/components/desktop/GridStage.tsx","../src/components/StageUtils.ts","../src/components/desktop/SpeakerStage.tsx","../src/components/mobile/MobileStage.tsx","../src/components/StageView.tsx","../node_modules/babel-plugin-transform-async-to-promises/helpers.mjs","../src/useRoom.ts","../src/LiveKitRoom.tsx"],"sourcesContent":["import { Track } from \"livekit-client\";\nimport { useEffect, useRef } from \"react\";\n\nexport interface AudioTrackProps {\n  track: Track;\n  isLocal: boolean;\n}\n\nexport const AudioRenderer = ({ track, isLocal }: AudioTrackProps) => {\n  const audioEl = useRef<HTMLAudioElement>();\n\n  useEffect(() => {\n    if (isLocal) {\n      // don't play own audio\n      return;\n    }\n    audioEl.current = track.attach();\n    if (track.sid) {\n      audioEl.current.setAttribute(\"data-audio-track-id\", track.sid);\n    }\n    return () => track.detach().forEach((el) => el.remove());\n  }, [track, isLocal]);\n\n  // TODO: allow set sink id\n  return null;\n};\n","import {\n  faChevronDown,\n  IconDefinition,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport React, { ReactElement, useState } from \"react\";\nimport { Popover } from \"react-tiny-popover\";\nimport styles from \"./styles.module.css\";\n\ninterface ButtonProps {\n  label: string;\n  disabled?: boolean;\n  onClick?: () => void;\n  icon?: IconDefinition;\n  className?: string;\n  popoverContainerClassName?: string;\n  popoverTriggerBtnClassName?: string;\n  popoverTriggerBtnSeparatorClassName?: string;\n  menuItems?: MenuItem[];\n  onMenuItemClick?: (item: MenuItem) => void;\n}\n\nexport interface MenuItem {\n  label: string;\n}\n\nexport const ControlButton = ({\n  label,\n  disabled,\n  onClick,\n  icon,\n  className,\n  menuItems,\n  popoverContainerClassName,\n  popoverTriggerBtnClassName,\n  popoverTriggerBtnSeparatorClassName,\n  onMenuItemClick,\n}: ButtonProps) => {\n  const [menuVisible, setMenuVisible] = useState(false);\n\n  let classes = styles.button;\n  if (className) {\n    classes += ` ${className}`;\n  }\n\n  const handleMenuClick = (item: MenuItem) => {\n    setMenuVisible(false);\n    if (onMenuItemClick) {\n      onMenuItemClick(item);\n    }\n  };\n\n  let menuTrigger: ReactElement | undefined;\n  let menu: ReactElement = <div />;\n  if (menuItems && menuItems.length > 0) {\n    classes += ` ${styles.hasDropdown}`;\n    menuTrigger = (\n      <button\n        disabled={disabled}\n        className={`${styles.button} ${popoverTriggerBtnClassName}  ${styles.dropdown}`}\n        onClick={() => setMenuVisible(!menuVisible)}\n      >\n        <div\n          className={`${styles.separator} ${popoverTriggerBtnSeparatorClassName}`}\n        />\n        <FontAwesomeIcon height={32} icon={faChevronDown} />\n      </button>\n    );\n\n    menu = (\n      <div className={`${styles.popoverMenu} ${popoverContainerClassName}`}>\n        <ul className={styles.list}>\n          {menuItems?.map((item, i) => {\n            return (\n              <li key={i} onClick={() => handleMenuClick(item)}>\n                {item.label}\n              </li>\n            );\n          })}\n        </ul>\n      </div>\n    );\n  }\n\n  const mainContent = (\n    <button\n      disabled={disabled}\n      className={classes}\n      onClick={() => {\n        setMenuVisible(false);\n        if (onClick) onClick();\n      }}\n    >\n      {icon && (\n        <FontAwesomeIcon className={styles.icon} height={32} icon={icon} />\n      )}\n      {label}\n    </button>\n  );\n\n  if (!menuTrigger) {\n    return mainContent;\n  }\n\n  return (\n    <Popover isOpen={menuVisible} positions={[\"top\"]} content={menu}>\n      <div className={styles.buttonWrapper}>\n        {mainContent}\n        {menuTrigger}\n      </div>\n    </Popover>\n  );\n};\n","import {\n  faMicrophone,\n  faMicrophoneSlash,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { Room } from \"livekit-client\";\nimport React, { useCallback, useEffect, useState } from \"react\";\nimport { ControlButton, MenuItem } from \"./ControlButton\";\n\nexport interface AudioSelectButtonProps {\n  isMuted: boolean;\n  onClick?: () => void;\n  onSourceSelected?: (device: MediaDeviceInfo) => void;\n  isButtonDisabled?: boolean;\n  muteText?: string;\n  unmuteText?: string;\n  className?: string;\n  popoverContainerClassName?: string;\n  popoverTriggerBtnClassName?: string;\n  popoverTriggerBtnSeparatorClassName?: string;\n}\n\nexport const AudioSelectButton = ({\n  isMuted,\n  onClick,\n  onSourceSelected,\n  isButtonDisabled,\n  muteText = \"Mute\",\n  unmuteText = \"Unmute\",\n  className,\n  popoverContainerClassName,\n  popoverTriggerBtnClassName,\n  popoverTriggerBtnSeparatorClassName,\n}: AudioSelectButtonProps) => {\n  const [sources, setSources] = useState<MediaDeviceInfo[]>([]);\n  const [menuItems, setMenuItems] = useState<MenuItem[]>([]);\n\n  const listAudioDevices = useCallback(async () => {\n    const devices = await Room.getLocalDevices(\"audioinput\");\n    setSources(devices);\n    setMenuItems(\n      devices.map((item) => {\n        return { label: item.label };\n      })\n    );\n  }, []);\n\n  useEffect(() => {\n    listAudioDevices();\n    navigator.mediaDevices.addEventListener(\"devicechange\", listAudioDevices);\n\n    return () => {\n      navigator.mediaDevices.removeEventListener(\n        \"devicechange\",\n        listAudioDevices\n      );\n    };\n  }, []);\n\n  const handleMenuItem = (item: MenuItem) => {\n    const device = sources.find((d) => d.label === item.label);\n    if (device && onSourceSelected) {\n      onSourceSelected(device);\n    }\n  };\n\n  return (\n    <ControlButton\n      label={isMuted ? unmuteText : muteText}\n      icon={isMuted ? faMicrophoneSlash : faMicrophone}\n      disabled={isButtonDisabled}\n      onClick={onClick}\n      menuItems={menuItems}\n      onMenuItemClick={handleMenuItem}\n      className={className}\n      popoverContainerClassName={popoverContainerClassName}\n      popoverTriggerBtnClassName={popoverTriggerBtnClassName}\n      popoverTriggerBtnSeparatorClassName={popoverTriggerBtnSeparatorClassName}\n    />\n  );\n};\n","import {\n  ConnectionQuality,\n  LocalParticipant,\n  Participant,\n  ParticipantEvent,\n  Track,\n  TrackPublication,\n} from \"livekit-client\";\nimport { useEffect, useState } from \"react\";\n\nexport interface ParticipantState {\n  isSpeaking: boolean;\n  connectionQuality: ConnectionQuality;\n  isLocal: boolean;\n  metadata?: string;\n  publications: TrackPublication[];\n  subscribedTracks: TrackPublication[];\n  cameraPublication?: TrackPublication;\n  microphonePublication?: TrackPublication;\n  screenSharePublication?: TrackPublication;\n}\n\nexport function useParticipant(participant: Participant): ParticipantState {\n  const [isAudioMuted, setAudioMuted] = useState(false);\n  const [, setVideoMuted] = useState(false);\n  const [connectionQuality, setConnectionQuality] = useState<ConnectionQuality>(\n    participant.connectionQuality\n  );\n  const [isSpeaking, setSpeaking] = useState(false);\n  const [metadata, setMetadata] = useState<string>();\n  const [publications, setPublications] = useState<TrackPublication[]>([]);\n  const [subscribedTracks, setSubscribedTracks] = useState<TrackPublication[]>(\n    []\n  );\n\n  const onPublicationsChanged = () => {\n    setPublications(Array.from(participant.tracks.values()));\n    setSubscribedTracks(\n      Array.from(participant.tracks.values()).filter((pub) => {\n        return pub.isSubscribed && pub.track !== undefined;\n      })\n    );\n  };\n\n  useEffect(() => {\n    const onMuted = (pub: TrackPublication) => {\n      if (pub.kind === Track.Kind.Audio) {\n        setAudioMuted(true);\n      } else if (pub.kind === Track.Kind.Video) {\n        setVideoMuted(true);\n      }\n    };\n    const onUnmuted = (pub: TrackPublication) => {\n      if (pub.kind === Track.Kind.Audio) {\n        setAudioMuted(false);\n      } else if (pub.kind === Track.Kind.Video) {\n        setVideoMuted(false);\n      }\n    };\n    const onMetadataChanged = () => {\n      if (participant.metadata) {\n        setMetadata(participant.metadata);\n      }\n    };\n    const onIsSpeakingChanged = () => {\n      setSpeaking(participant.isSpeaking);\n    };\n    const onConnectionQualityUpdate = () => {\n      setConnectionQuality(participant.connectionQuality);\n    };\n\n    // register listeners\n    participant\n      .on(ParticipantEvent.TrackMuted, onMuted)\n      .on(ParticipantEvent.TrackUnmuted, onUnmuted)\n      .on(ParticipantEvent.ParticipantMetadataChanged, onMetadataChanged)\n      .on(ParticipantEvent.IsSpeakingChanged, onIsSpeakingChanged)\n      .on(ParticipantEvent.TrackPublished, onPublicationsChanged)\n      .on(ParticipantEvent.TrackUnpublished, onPublicationsChanged)\n      .on(ParticipantEvent.TrackSubscribed, onPublicationsChanged)\n      .on(ParticipantEvent.TrackUnsubscribed, onPublicationsChanged)\n      .on(ParticipantEvent.LocalTrackPublished, onPublicationsChanged)\n      .on(ParticipantEvent.LocalTrackUnpublished, onPublicationsChanged)\n      .on(ParticipantEvent.ConnectionQualityChanged, onConnectionQualityUpdate);\n\n    // set initial state\n    onMetadataChanged();\n    onIsSpeakingChanged();\n    onPublicationsChanged();\n\n    return () => {\n      // cleanup\n      participant\n        .off(ParticipantEvent.TrackMuted, onMuted)\n        .off(ParticipantEvent.TrackUnmuted, onUnmuted)\n        .off(ParticipantEvent.ParticipantMetadataChanged, onMetadataChanged)\n        .off(ParticipantEvent.IsSpeakingChanged, onIsSpeakingChanged)\n        .off(ParticipantEvent.TrackPublished, onPublicationsChanged)\n        .off(ParticipantEvent.TrackUnpublished, onPublicationsChanged)\n        .off(ParticipantEvent.TrackSubscribed, onPublicationsChanged)\n        .off(ParticipantEvent.TrackUnsubscribed, onPublicationsChanged)\n        .off(ParticipantEvent.LocalTrackPublished, onPublicationsChanged)\n        .off(ParticipantEvent.LocalTrackUnpublished, onPublicationsChanged)\n        .off(\n          ParticipantEvent.ConnectionQualityChanged,\n          onConnectionQualityUpdate\n        );\n    };\n  }, [participant]);\n\n  let muted: boolean | undefined;\n  participant.audioTracks.forEach((pub) => {\n    muted = pub.isMuted;\n  });\n  if (muted === undefined) {\n    muted = true;\n  }\n  if (isAudioMuted !== muted) {\n    setAudioMuted(muted);\n  }\n\n  return {\n    isLocal: participant instanceof LocalParticipant,\n    isSpeaking,\n    connectionQuality,\n    publications,\n    subscribedTracks,\n    cameraPublication: participant.getTrack(Track.Source.Camera),\n    microphonePublication: participant.getTrack(Track.Source.Microphone),\n    screenSharePublication: participant.getTrack(Track.Source.ScreenShare),\n    metadata,\n  };\n}\n","import { faVideo, faVideoSlash } from \"@fortawesome/free-solid-svg-icons\";\nimport { Room } from \"livekit-client\";\nimport React, { useCallback, useEffect, useState } from \"react\";\nimport { ControlButton, MenuItem } from \"./ControlButton\";\n\nexport interface VideoSelectButtonProps {\n  isEnabled: boolean;\n  onClick?: () => void;\n  onSourceSelected?: (device: MediaDeviceInfo) => void;\n  disableText?: string;\n  enableText?: string;\n  className?: string;\n  isButtonDisabled?: boolean;\n  popoverContainerClassName?: string;\n  popoverTriggerBtnClassName?: string;\n  popoverTriggerBtnSeparatorClassName?: string;\n}\n\nexport const VideoSelectButton = ({\n  isEnabled,\n  onClick,\n  onSourceSelected,\n  disableText = \"Disable Video\",\n  enableText = \"Enable Video\",\n  className,\n  isButtonDisabled,\n  popoverContainerClassName,\n  popoverTriggerBtnClassName,\n  popoverTriggerBtnSeparatorClassName,\n}: VideoSelectButtonProps) => {\n  const [sources, setSources] = useState<MediaDeviceInfo[]>([]);\n  const [menuItems, setMenuItems] = useState<MenuItem[]>([]);\n\n  const listVideoDevices = useCallback(async () => {\n    const devices = await Room.getLocalDevices(\"videoinput\");\n    setSources(devices);\n    setMenuItems(\n      devices.map((item) => {\n        return { label: item.label };\n      })\n    );\n  }, []);\n\n  useEffect(() => {\n    listVideoDevices();\n    navigator.mediaDevices.addEventListener(\"devicechange\", listVideoDevices);\n    return () => {\n      navigator.mediaDevices.removeEventListener(\n        \"devicechange\",\n        listVideoDevices\n      );\n    };\n  }, []);\n\n  const handleMenuItem = (item: MenuItem) => {\n    const device = sources.find((d) => d.label === item.label);\n    if (device && onSourceSelected) {\n      onSourceSelected(device);\n    }\n  };\n\n  return (\n    <ControlButton\n      label={isEnabled ? disableText : enableText}\n      icon={isEnabled ? faVideo : faVideoSlash}\n      disabled={isButtonDisabled}\n      onClick={onClick}\n      menuItems={menuItems}\n      onMenuItemClick={handleMenuItem}\n      className={className}\n      popoverContainerClassName={popoverContainerClassName}\n      popoverTriggerBtnClassName={popoverTriggerBtnClassName}\n      popoverTriggerBtnSeparatorClassName={popoverTriggerBtnSeparatorClassName}\n    />\n  );\n};\n","import { faDesktop, faStop } from \"@fortawesome/free-solid-svg-icons\";\nimport { Room } from \"livekit-client\";\nimport React, { ReactElement } from \"react\";\nimport { useParticipant } from \"../useParticipant\";\nimport { AudioSelectButton } from \"./AudioSelectButton\";\nimport { ControlButton } from \"./ControlButton\";\nimport styles from \"./styles.module.css\";\nimport { VideoSelectButton } from \"./VideoSelectButton\";\n\nexport interface ControlsProps {\n  room: Room;\n  enableScreenShare?: boolean;\n  enableAudio?: boolean;\n  enableVideo?: boolean;\n  onLeave?: (room: Room) => void;\n}\n\nexport const ControlsView = ({\n  room,\n  enableScreenShare,\n  enableAudio,\n  enableVideo,\n  onLeave,\n}: ControlsProps) => {\n  const { cameraPublication: camPub } = useParticipant(room.localParticipant);\n\n  if (enableScreenShare === undefined) {\n    enableScreenShare = true;\n  }\n  if (enableVideo === undefined) {\n    enableVideo = true;\n  }\n  if (enableAudio === undefined) {\n    enableAudio = true;\n  }\n\n  const [audioButtonDisabled, setAudioButtonDisabled] = React.useState(false);\n  let muteButton: ReactElement | undefined;\n  if (enableAudio) {\n    const enabled = room.localParticipant.isMicrophoneEnabled;\n    muteButton = (\n      <AudioSelectButton\n        isMuted={!enabled}\n        isButtonDisabled={audioButtonDisabled}\n        onClick={async () => {\n          setAudioButtonDisabled(true);\n          room.localParticipant\n            .setMicrophoneEnabled(!enabled)\n            .finally(() => setAudioButtonDisabled(false));\n        }}\n        onSourceSelected={(device) => {\n          setAudioButtonDisabled(true);\n          room\n            .switchActiveDevice(\"audioinput\", device.deviceId)\n            .finally(() => setAudioButtonDisabled(false));\n        }}\n      />\n    );\n  }\n\n  const [videoButtonDisabled, setVideoButtonDisabled] = React.useState(false);\n\n  let videoButton: ReactElement | undefined;\n  if (enableVideo) {\n    const enabled = !(camPub?.isMuted ?? true);\n    videoButton = (\n      <VideoSelectButton\n        isEnabled={enabled}\n        isButtonDisabled={videoButtonDisabled}\n        onClick={() => {\n          setVideoButtonDisabled(true);\n          room.localParticipant\n            .setCameraEnabled(!enabled)\n            .finally(() => setVideoButtonDisabled(false));\n        }}\n        onSourceSelected={(device) => {\n          setVideoButtonDisabled(true);\n          room\n            .switchActiveDevice(\"videoinput\", device.deviceId)\n            .finally(() => setVideoButtonDisabled(false));\n        }}\n      />\n    );\n  }\n\n  const [screenButtonDisabled, setScreenButtonDisabled] = React.useState(false);\n  let screenButton: ReactElement | undefined;\n  if (enableScreenShare) {\n    const enabled = room.localParticipant.isScreenShareEnabled;\n    screenButton = (\n      <ControlButton\n        label={enabled ? \"Stop sharing\" : \"Share screen\"}\n        icon={enabled ? faStop : faDesktop}\n        disabled={screenButtonDisabled}\n        onClick={() => {\n          setScreenButtonDisabled(true);\n          room.localParticipant\n            .setScreenShareEnabled(!enabled)\n            .finally(() => setScreenButtonDisabled(false));\n        }}\n      />\n    );\n  }\n\n  return (\n    <div className={styles.controlsWrapper}>\n      {muteButton}\n      {videoButton}\n      {screenButton}\n      {onLeave && (\n        <ControlButton\n          label=\"End\"\n          className={styles.dangerButton}\n          onClick={() => {\n            room.disconnect();\n            onLeave(room);\n          }}\n        />\n      )}\n    </div>\n  );\n};\n","import React from \"react\";\n\nexport interface DisplayOptions {\n  stageLayout?: string;\n  /** display debugging stats */\n  showStats?: boolean;\n}\n\nexport const DisplayContext = React.createContext<DisplayOptions>({\n  stageLayout: \"grid\",\n  showStats: false,\n});\n","import { Property } from \"csstype\";\nimport { Track } from \"livekit-client\";\nimport React, { CSSProperties, useCallback, useEffect, useRef } from \"react\";\nimport styles from \"./styles.module.css\";\n\nexport interface VideoRendererProps {\n  track: Track;\n  isLocal: boolean;\n  objectFit?: Property.ObjectFit;\n  className?: string;\n  width?: Property.Width;\n  height?: Property.Height;\n  onSizeChanged?: (width: number, height: number) => void;\n}\n\nexport const VideoRenderer = ({\n  track,\n  isLocal,\n  objectFit,\n  className,\n  onSizeChanged,\n  width,\n  height,\n}: VideoRendererProps) => {\n  const ref = useRef<HTMLVideoElement>(null);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (!el) {\n      return;\n    }\n    el.muted = true;\n    track.attach(el);\n    return () => {\n      track.detach(el);\n    };\n  }, [track, ref]);\n\n  const handleResize = useCallback((ev: UIEvent) => {\n    if (ev.target instanceof HTMLVideoElement) {\n      if (onSizeChanged) {\n        onSizeChanged(ev.target.videoWidth, ev.target.videoHeight);\n      }\n    }\n  }, []);\n\n  useEffect(() => {\n    const el = ref.current;\n    if (el) {\n      el.addEventListener(\"resize\", handleResize);\n    }\n    return () => {\n      el?.removeEventListener(\"resize\", handleResize);\n    };\n  }, [ref]);\n\n  const isFrontFacing =\n    isLocal &&\n    track.mediaStreamTrack?.getSettings().facingMode !== \"environment\";\n  const style: CSSProperties = {\n    transform: isLocal && isFrontFacing ? \"rotateY(180deg)\" : \"\",\n    width: width,\n    height: height,\n  };\n  if (objectFit) {\n    style.objectFit = objectFit;\n  }\n\n  return (\n    <video ref={ref} className={className ?? styles.video} style={style} />\n  );\n};\n","import {\n  faMicrophone,\n  faMicrophoneSlash,\n} from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { Property } from \"csstype\";\nimport {\n  ConnectionQuality,\n  LocalTrack,\n  Participant,\n  RemoteTrack,\n} from \"livekit-client\";\nimport React, {\n  CSSProperties,\n  ReactElement,\n  useCallback,\n  useContext,\n  useEffect,\n  useState,\n} from \"react\";\nimport { AspectRatio } from \"react-aspect-ratio\";\nimport { ReactComponent as connectionQuality1 } from \"../../static/connection-quality-1.svg\";\nimport { ReactComponent as connectionQuality2 } from \"../../static/connection-quality-2.svg\";\nimport { ReactComponent as connectionQuality3 } from \"../../static/connection-quality-3.svg\";\nimport { useParticipant } from \"../useParticipant\";\nimport { DisplayContext } from \"./DisplayContext\";\nimport styles from \"./styles.module.css\";\nimport { VideoRenderer } from \"./VideoRenderer\";\n\nexport interface ParticipantProps {\n  participant: Participant;\n  displayName?: string;\n  // width in CSS\n  width?: Property.Width;\n  // height in CSS\n  height?: Property.Height;\n  className?: string;\n  // aspect ratio width, if set, maintains aspect ratio\n  aspectWidth?: number;\n  // aspect ratio height\n  aspectHeight?: number;\n  // determine whether to contain or cover video.\n  // cover mode is used when layout orientation matches video orientation\n  orientation?: \"landscape\" | \"portrait\";\n  // true if overlay with participant info should be shown\n  showOverlay?: boolean;\n  // true if connection quality should be shown\n  showConnectionQuality?: boolean;\n  // additional classname when participant is currently speaking\n  speakerClassName?: string;\n  onMouseEnter?: () => void;\n  onMouseLeave?: () => void;\n  onClick?: () => void;\n}\n\nexport const ParticipantView = ({\n  participant,\n  width,\n  height,\n  className,\n  speakerClassName,\n  aspectWidth,\n  aspectHeight,\n  orientation,\n  displayName,\n  showOverlay,\n  showConnectionQuality,\n  onMouseEnter,\n  onMouseLeave,\n  onClick,\n}: ParticipantProps) => {\n  const { cameraPublication, isLocal, connectionQuality, isSpeaking } =\n    useParticipant(participant);\n  const [videoSize, setVideoSize] = useState<string>();\n  const [currentBitrate, setCurrentBitrate] = useState<number>();\n  const context = useContext(DisplayContext);\n\n  const handleResize = useCallback((width: number, height: number) => {\n    setVideoSize(`${width}x${height}`);\n  }, []);\n\n  useEffect(() => {\n    const interval = setInterval(() => {\n      let total = 0;\n      participant.tracks.forEach((pub) => {\n        if (\n          pub.track instanceof LocalTrack ||\n          pub.track instanceof RemoteTrack\n        ) {\n          total += pub.track.currentBitrate;\n        }\n      });\n      setCurrentBitrate(total);\n    }, 1000);\n    return () => {\n      clearInterval(interval);\n    };\n  }, []);\n\n  const containerStyles: CSSProperties = {\n    width: width,\n    height: height,\n  };\n\n  // when aspect matches, cover instead\n  let objectFit: Property.ObjectFit = \"contain\";\n  let videoOrientation: \"landscape\" | \"portrait\" | undefined;\n  if (!orientation && aspectWidth && aspectHeight) {\n    orientation = aspectWidth > aspectHeight ? \"landscape\" : \"portrait\";\n  }\n  if (cameraPublication?.dimensions) {\n    videoOrientation =\n      cameraPublication.dimensions.width > cameraPublication.dimensions.height\n        ? \"landscape\"\n        : \"portrait\";\n  }\n\n  if (videoOrientation === orientation) {\n    objectFit = \"cover\";\n  }\n\n  if (!displayName) {\n    displayName = participant.name || participant.identity;\n    if (isLocal) {\n      displayName += \" (You)\";\n    }\n  }\n\n  let mainElement: ReactElement;\n  if (\n    cameraPublication?.isSubscribed &&\n    cameraPublication?.track &&\n    !cameraPublication?.isMuted\n  ) {\n    mainElement = (\n      <VideoRenderer\n        track={cameraPublication.track}\n        isLocal={isLocal}\n        objectFit={objectFit}\n        width=\"100%\"\n        height=\"100%\"\n        onSizeChanged={handleResize}\n      />\n    );\n  } else {\n    mainElement = <div className={styles.placeholder} />;\n  }\n\n  const classes = [styles.participant];\n  if (className) {\n    classes.push(className);\n  }\n  if (isSpeaking) {\n    classes.push(speakerClassName ?? styles.speaker);\n  }\n  const isAudioMuted = !participant.isMicrophoneEnabled;\n\n  // gather stats\n  let statsContent: ReactElement | undefined;\n  if (context.showStats) {\n    statsContent = (\n      <div className={styles.stats}>\n        <span>{videoSize}</span>\n        {currentBitrate !== undefined && currentBitrate > 0 && (\n          <span>&nbsp;{Math.round(currentBitrate / 1024)} kbps</span>\n        )}\n      </div>\n    );\n  }\n\n  let ConnectionQualityIndicator: typeof connectionQuality1 | undefined;\n  if (showConnectionQuality) {\n    switch (connectionQuality) {\n      case ConnectionQuality.Excellent:\n        ConnectionQualityIndicator = connectionQuality3;\n        break;\n      case ConnectionQuality.Good:\n        ConnectionQualityIndicator = connectionQuality2;\n        break;\n      case ConnectionQuality.Poor:\n        ConnectionQualityIndicator = connectionQuality1;\n        break;\n    }\n  }\n\n  return (\n    <div\n      className={classes.join(\" \")}\n      style={containerStyles}\n      onMouseEnter={onMouseEnter}\n      onMouseLeave={onMouseLeave}\n      onClick={onClick}\n    >\n      {aspectWidth && aspectHeight && (\n        <AspectRatio ratio={aspectWidth / aspectHeight}>\n          {mainElement}\n        </AspectRatio>\n      )}\n      {(!aspectWidth || !aspectHeight) && mainElement}\n\n      {(showOverlay || context.showStats) && (\n        <div className={styles.participantBar}>\n          <div className={styles.name}>{displayName}</div>\n          <div className={styles.center}>{statsContent}</div>\n          <div>\n            {ConnectionQualityIndicator && <ConnectionQualityIndicator />}\n          </div>\n          <div>\n            <FontAwesomeIcon\n              icon={isAudioMuted ? faMicrophoneSlash : faMicrophone}\n              height={24}\n              className={isAudioMuted ? styles.iconRed : styles.iconNormal}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n","import { Property } from \"csstype\";\nimport { Track } from \"livekit-client\";\nimport React from \"react\";\nimport styles from \"./styles.module.css\";\nimport { VideoRenderer } from \"./VideoRenderer\";\n\ninterface ScreenShareProps {\n  track: Track;\n  width?: Property.Width;\n  height?: Property.Height;\n}\n\nexport const ScreenShareView = ({ track, width, height }: ScreenShareProps) => {\n  return (\n    <div className={styles.screenShare}>\n      <VideoRenderer\n        track={track}\n        isLocal={false}\n        width={width}\n        height={height}\n      />\n    </div>\n  );\n};\n","import { Participant } from \"livekit-client\";\nimport React, { useEffect, useState } from \"react\";\nimport { ControlsView } from \"../ControlsView\";\nimport { ParticipantView } from \"../ParticipantView\";\nimport { StageProps } from \"../StageProps\";\nimport styles from \"./styles.module.css\";\n\nexport const GridStage = ({\n  roomState,\n  participantRenderer,\n  controlRenderer,\n  onLeave,\n}: StageProps) => {\n  const { isConnecting, error, participants, room } = roomState;\n  const [visibleParticipants, setVisibleParticipants] = useState<Participant[]>(\n    []\n  );\n  const [showOverlay, setShowOverlay] = useState(false);\n  const [gridClass, setGridClass] = React.useState(styles.grid1x1);\n\n  // compute visible participants and sort.\n  useEffect(() => {\n    // determine grid size\n    let numVisible = 1;\n    if (participants.length === 1) {\n      setGridClass(styles.grid1x1);\n    } else if (participants.length === 2) {\n      setGridClass(styles.grid2x1);\n      numVisible = 2;\n    } else if (participants.length <= 4) {\n      setGridClass(styles.grid2x2);\n      numVisible = Math.min(participants.length, 4);\n    } else if (participants.length <= 9) {\n      setGridClass(styles.grid3x3);\n      numVisible = Math.min(participants.length, 9);\n    } else if (participants.length <= 16) {\n      setGridClass(styles.grid4x4);\n      numVisible = Math.min(participants.length, 16);\n    } else {\n      setGridClass(styles.grid5x5);\n      numVisible = Math.min(participants.length, 25);\n    }\n\n    // remove any participants that are no longer connected\n    const newParticipants: Participant[] = [];\n    visibleParticipants.forEach((p) => {\n      if (\n        room?.participants.has(p.sid) ||\n        room?.localParticipant.sid === p.sid\n      ) {\n        newParticipants.push(p);\n      }\n    });\n\n    // ensure active speakers are all visible\n    room?.activeSpeakers?.forEach((speaker) => {\n      if (\n        newParticipants.includes(speaker) ||\n        (speaker !== room?.localParticipant &&\n          !room?.participants.has(speaker.sid))\n      ) {\n        return;\n      }\n      // find a non-active speaker and switch\n      const idx = newParticipants.findIndex((p) => !p.isSpeaking);\n      if (idx >= 0) {\n        newParticipants[idx] = speaker;\n      } else {\n        newParticipants.push(speaker);\n      }\n    });\n\n    // add other non speakers\n    for (const p of participants) {\n      if (newParticipants.length >= numVisible) {\n        break;\n      }\n      if (newParticipants.includes(p) || p.isSpeaking) {\n        continue;\n      }\n      newParticipants.push(p);\n    }\n\n    if (newParticipants.length > numVisible) {\n      newParticipants.splice(numVisible, newParticipants.length - numVisible);\n    }\n    setVisibleParticipants(newParticipants);\n  }, [participants]);\n\n  if (error) {\n    return <div>error {error.message}</div>;\n  }\n\n  if (isConnecting) {\n    return <div>connecting</div>;\n  }\n  if (!room) {\n    return <div>room closed</div>;\n  }\n\n  if (participants.length === 0) {\n    return <div>no one is in the room</div>;\n  }\n\n  const ParticipantRenderer = participantRenderer ?? ParticipantView;\n  const ControlRenderer = controlRenderer ?? ControlsView;\n\n  return (\n    // global container\n    <div className={styles.container}>\n      <div className={`${styles.gridStage} ${gridClass}`}>\n        {visibleParticipants.map((participant) => {\n          return (\n            <ParticipantRenderer\n              key={participant.identity}\n              participant={participant}\n              orientation=\"landscape\"\n              width=\"100%\"\n              height=\"100%\"\n              showOverlay={showOverlay}\n              showConnectionQuality\n              onMouseEnter={() => setShowOverlay(true)}\n              onMouseLeave={() => setShowOverlay(false)}\n            />\n          );\n        })}\n      </div>\n      <div className={styles.controlsArea}>\n        <ControlRenderer room={room} onLeave={onLeave} />\n      </div>\n    </div>\n  );\n};\n","import { LocalParticipant, Participant } from \"livekit-client\";\n\n/**\n * Default sort for participants, it'll order participants by:\n * 1. dominant speaker (speaker with the loudest audio level)\n * 2. local participant\n * 3. other speakers that are recently active\n * 4. participants with video on\n * 5. by joinedAt\n */\nexport function defaultSortParticipants(\n  participants: Participant[]\n): Participant[] {\n  const sortedParticipants = [...participants];\n  sortedParticipants.sort((a, b) => {\n    // loudest speaker first\n    if (a.isSpeaking && b.isSpeaking) {\n      return b.audioLevel - a.audioLevel;\n    }\n\n    // speaker goes first\n    if (a.isSpeaking !== b.isSpeaking) {\n      if (a.isSpeaking) {\n        return -1;\n      } else {\n        return 1;\n      }\n    }\n\n    // last active speaker first\n    if (a.lastSpokeAt !== b.lastSpokeAt) {\n      const aLast = a.lastSpokeAt?.getTime() ?? 0;\n      const bLast = b.lastSpokeAt?.getTime() ?? 0;\n      return bLast - aLast;\n    }\n\n    // video on\n    const aVideo = a.videoTracks.size > 0;\n    const bVideo = b.videoTracks.size > 0;\n    if (aVideo !== bVideo) {\n      if (aVideo) {\n        return -1;\n      } else {\n        return 1;\n      }\n    }\n\n    // joinedAt\n    return (a.joinedAt?.getTime() ?? 0) - (b.joinedAt?.getTime() ?? 0);\n  });\n  const localParticipant = sortedParticipants.find(\n    (p) => p instanceof LocalParticipant\n  );\n  if (localParticipant) {\n    const localIdx = sortedParticipants.indexOf(localParticipant);\n    if (localIdx >= 0) {\n      sortedParticipants.splice(localIdx, 1);\n      if (sortedParticipants.length > 0) {\n        sortedParticipants.splice(1, 0, localParticipant);\n      } else {\n        sortedParticipants.push(localParticipant);\n      }\n    }\n  }\n  return sortedParticipants;\n}\n","import { Track, VideoTrack } from \"livekit-client\";\nimport React, { ReactElement, useEffect, useState } from \"react\";\nimport { ControlsView } from \"../ControlsView\";\nimport { ParticipantView } from \"../ParticipantView\";\nimport { ScreenShareView } from \"../ScreenShareView\";\nimport { StageProps } from \"../StageProps\";\nimport { defaultSortParticipants } from \"../StageUtils\";\nimport styles from \"./styles.module.css\";\n\nexport const SpeakerStage = ({\n  roomState,\n  participantRenderer,\n  controlRenderer,\n  onLeave,\n  sortParticipants,\n}: StageProps) => {\n  const { isConnecting, error, participants, room } = roomState;\n  const [showOverlay, setShowOverlay] = useState(false);\n  const sortFn = sortParticipants ?? defaultSortParticipants;\n  const [sortedParticipants, setSortedParticipants] = useState(\n    sortFn(participants)\n  );\n\n  useEffect(() => {\n    setSortedParticipants(sortFn(participants));\n  }, [participants, sortFn]);\n\n  if (error) {\n    return <div>error {error.message}</div>;\n  }\n\n  if (isConnecting) {\n    return <div>connecting</div>;\n  }\n  if (!room) {\n    return <div>room closed</div>;\n  }\n\n  if (sortedParticipants.length === 0) {\n    return <div>no one is in the room</div>;\n  }\n\n  const ParticipantRenderer = participantRenderer ?? ParticipantView;\n  const ControlRenderer = controlRenderer ?? ControlsView;\n\n  // find first participant with screen shared\n  let screenTrack: VideoTrack | undefined;\n  sortedParticipants.forEach((p) => {\n    if (screenTrack) {\n      return;\n    }\n    const track = p.getTrack(Track.Source.ScreenShare);\n    if (track?.isSubscribed && track.videoTrack) {\n      screenTrack = track.videoTrack;\n    }\n  });\n\n  const otherParticipants = sortedParticipants;\n  let mainView: ReactElement;\n  if (screenTrack) {\n    mainView = (\n      <ScreenShareView track={screenTrack} height=\"100%\" width=\"100%\" />\n    );\n  } else {\n    mainView = (\n      <ParticipantRenderer\n        key={sortedParticipants[0].identity}\n        participant={sortedParticipants[0]}\n        width=\"100%\"\n        height=\"100%\"\n        orientation=\"landscape\"\n        showOverlay={showOverlay}\n        showConnectionQuality\n        onMouseEnter={() => setShowOverlay(true)}\n        onMouseLeave={() => setShowOverlay(false)}\n      />\n    );\n  }\n\n  return (\n    // global container\n    <div className={styles.container}>\n      <div className={styles.stage}>\n        <div className={styles.stageCenter}>{mainView}</div>\n        <div className={styles.sidebar}>\n          {otherParticipants.map((participant) => {\n            return (\n              <ParticipantRenderer\n                key={participant.identity}\n                participant={participant}\n                width=\"100%\"\n                aspectWidth={16}\n                aspectHeight={9}\n                showOverlay={showOverlay}\n                onMouseEnter={() => setShowOverlay(true)}\n                onMouseLeave={() => setShowOverlay(false)}\n              />\n            );\n          })}\n        </div>\n      </div>\n      <div className={styles.controlsArea}>\n        <ControlRenderer room={room} onLeave={onLeave} />\n      </div>\n    </div>\n  );\n};\n","import { Track, VideoTrack } from \"livekit-client\";\nimport React, { ReactElement, useEffect, useState } from \"react\";\nimport { ControlsView } from \"../ControlsView\";\nimport { ParticipantView } from \"../ParticipantView\";\nimport { ScreenShareView } from \"../ScreenShareView\";\nimport { StageProps } from \"../StageProps\";\nimport { defaultSortParticipants } from \"../StageUtils\";\nimport styles from \"./styles.module.css\";\n\nexport const MobileStage = ({\n  roomState,\n  participantRenderer,\n  controlRenderer,\n  onLeave,\n  sortParticipants,\n}: StageProps) => {\n  const { isConnecting, error, participants, room } = roomState;\n  const [showOverlay, setShowOverlay] = useState(false);\n  const sortFn = sortParticipants ?? defaultSortParticipants;\n  const [sortedParticipants, setSortedParticipants] = useState(\n    sortFn(participants)\n  );\n\n  useEffect(() => {\n    setSortedParticipants(sortFn(participants));\n  }, [participants, sortFn]);\n\n  if (error) {\n    return <div>error {error.message}</div>;\n  }\n\n  if (isConnecting) {\n    return <div>connecting</div>;\n  }\n  if (!room) {\n    return <div>room closed</div>;\n  }\n\n  if (sortedParticipants.length === 0) {\n    return <div>no one is in the room</div>;\n  }\n\n  const ParticipantRenderer = participantRenderer ?? ParticipantView;\n  const ControlRenderer = controlRenderer ?? ControlsView;\n\n  // find first participant with screen shared\n  let screenTrack: VideoTrack | undefined;\n  sortedParticipants.forEach((p) => {\n    if (screenTrack) {\n      return;\n    }\n    const track = p.getTrack(Track.Source.ScreenShare);\n    if (track?.isSubscribed && track.videoTrack) {\n      screenTrack = track.videoTrack;\n    }\n  });\n\n  const otherParticipants = sortedParticipants;\n  let mainView: ReactElement;\n  if (screenTrack) {\n    mainView = (\n      <ScreenShareView track={screenTrack} height=\"100%\" width=\"100%\" />\n    );\n  } else {\n    mainView = (\n      <ParticipantRenderer\n        key={sortedParticipants[0].identity}\n        participant={sortedParticipants[0]}\n        showOverlay={showOverlay}\n        width=\"100%\"\n        height=\"100%\"\n        orientation=\"portrait\"\n        showConnectionQuality\n        onMouseEnter={() => setShowOverlay(true)}\n        onMouseLeave={() => setShowOverlay(false)}\n      />\n    );\n  }\n\n  return (\n    // global container\n    <div className={styles.container}>\n      <div className={styles.stage}>{mainView}</div>\n      <div className={styles.participantsArea}>\n        {otherParticipants.map((participant) => {\n          return (\n            <ParticipantRenderer\n              key={participant.identity}\n              participant={participant}\n              className={styles.participant}\n              aspectWidth={4}\n              aspectHeight={3}\n              showOverlay={showOverlay}\n              onMouseEnter={() => setShowOverlay(true)}\n              onMouseLeave={() => setShowOverlay(false)}\n            />\n          );\n        })}\n      </div>\n      <div className={styles.controlsArea}>\n        <ControlRenderer\n          room={room}\n          enableScreenShare={false}\n          onLeave={onLeave}\n        />\n      </div>\n    </div>\n  );\n};\n","import { faVolumeMute } from \"@fortawesome/free-solid-svg-icons\";\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\nimport { Track, VideoTrack } from \"livekit-client\";\nimport React, { ReactElement, useContext } from \"react\";\nimport { useMediaQuery } from \"react-responsive\";\nimport { AudioRenderer } from \"./AudioRenderer\";\nimport { GridStage } from \"./desktop/GridStage\";\nimport { SpeakerStage } from \"./desktop/SpeakerStage\";\nimport { DisplayContext } from \"./DisplayContext\";\nimport { MobileStage } from \"./mobile/MobileStage\";\nimport { StageProps } from \"./StageProps\";\nimport styles from \"./styles.module.css\";\n\nexport const StageView = (stageProps: StageProps) => {\n  const isMobile = useMediaQuery({ query: \"(max-width: 800px)\" });\n  const { room, participants } = stageProps.roomState;\n  const context = useContext(DisplayContext);\n\n  let mainElement: ReactElement;\n  if (isMobile) {\n    mainElement = <MobileStage {...stageProps} />;\n  } else {\n    // find first participant with screen shared\n    let screenTrack: VideoTrack | undefined;\n    participants.forEach((p) => {\n      if (screenTrack) {\n        return;\n      }\n      const track = p.getTrack(Track.Source.ScreenShare);\n      if (track?.isSubscribed && track.videoTrack) {\n        screenTrack = track.videoTrack;\n      }\n    });\n\n    if (context.stageLayout === \"grid\" && screenTrack === undefined) {\n      mainElement = <GridStage {...stageProps} />;\n    } else {\n      mainElement = <SpeakerStage {...stageProps} />;\n    }\n  }\n\n  return (\n    <div className={styles.container}>\n      {mainElement}\n      {stageProps.roomState.audioTracks.map((track) => (\n        <AudioRenderer key={track.sid} track={track} isLocal={false} />\n      ))}\n\n      {room?.canPlaybackAudio === false && (\n        <div className={styles.overlay}>\n          <button\n            className={styles.unmuteButton}\n            onClick={() => {\n              room.startAudio();\n            }}\n          >\n            <FontAwesomeIcon\n              className={styles.icon}\n              size=\"1x\"\n              icon={faVolumeMute}\n            />\n            Click to Unmute\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n","// A type of promise-like that resolves synchronously and supports only one observer\nexport const _Pact = /*#__PURE__*/(function() {\n\tfunction _Pact() {}\n\t_Pact.prototype.then = function(onFulfilled, onRejected) {\n\t\tconst result = new _Pact();\n\t\tconst state = this.s;\n\t\tif (state) {\n\t\t\tconst callback = state & 1 ? onFulfilled : onRejected;\n\t\t\tif (callback) {\n\t\t\t\ttry {\n\t\t\t\t\t_settle(result, 1, callback(this.v));\n\t\t\t\t} catch (e) {\n\t\t\t\t\t_settle(result, 2, e);\n\t\t\t\t}\n\t\t\t\treturn result;\n\t\t\t} else {\n\t\t\t\treturn this;\n\t\t\t}\n\t\t}\n\t\tthis.o = function(_this) {\n\t\t\ttry {\n\t\t\t\tconst value = _this.v;\n\t\t\t\tif (_this.s & 1) {\n\t\t\t\t\t_settle(result, 1, onFulfilled ? onFulfilled(value) : value);\n\t\t\t\t} else if (onRejected) {\n\t\t\t\t\t_settle(result, 1, onRejected(value));\n\t\t\t\t} else {\n\t\t\t\t\t_settle(result, 2, value);\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(result, 2, e);\n\t\t\t}\n\t\t};\n\t\treturn result;\n\t}\n\treturn _Pact;\n})();\n\n// Settles a pact synchronously\nexport function _settle(pact, state, value) {\n\tif (!pact.s) {\n\t\tif (value instanceof _Pact) {\n\t\t\tif (value.s) {\n\t\t\t\tif (state & 1) {\n\t\t\t\t\tstate = value.s;\n\t\t\t\t}\n\t\t\t\tvalue = value.v;\n\t\t\t} else {\n\t\t\t\tvalue.o = _settle.bind(null, pact, state);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tif (value && value.then) {\n\t\t\tvalue.then(_settle.bind(null, pact, state), _settle.bind(null, pact, 2));\n\t\t\treturn;\n\t\t}\n\t\tpact.s = state;\n\t\tpact.v = value;\n\t\tconst observer = pact.o;\n\t\tif (observer) {\n\t\t\tobserver(pact);\n\t\t}\n\t}\n}\n\nexport function _isSettledPact(thenable) {\n\treturn thenable instanceof _Pact && thenable.s & 1;\n}\n\n// Converts argument to a function that always returns a Promise\nexport function _async(f) {\n\treturn function() {\n\t\tfor (var args = [], i = 0; i < arguments.length; i++) {\n\t\t\targs[i] = arguments[i];\n\t\t}\n\t\ttry {\n\t\t\treturn Promise.resolve(f.apply(this, args));\n\t\t} catch(e) {\n\t\t\treturn Promise.reject(e);\n\t\t}\n\t}\n}\n\n// Awaits on a value that may or may not be a Promise (equivalent to the await keyword in ES2015, with continuations passed explicitly)\nexport function _await(value, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(value) : value;\n\t}\n\tif (!value || !value.then) {\n\t\tvalue = Promise.resolve(value);\n\t}\n\treturn then ? value.then(then) : value;\n}\n\n// Awaits on a value that may or may not be a Promise, then ignores it\nexport function _awaitIgnored(value, direct) {\n\tif (!direct) {\n\t\treturn value && value.then ? value.then(_empty) : Promise.resolve();\n\t}\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continue(value, then) {\n\treturn value && value.then ? value.then(then) : then(value);\n}\n\n// Proceeds after a value has resolved, or proceeds immediately if the value is not thenable\nexport function _continueIgnored(value) {\n\tif (value && value.then) {\n\t\treturn value.then(_empty);\n\t}\n}\n\n// Asynchronously iterate through an object that has a length property, passing the index as the first argument to the callback (even as the length property changes)\nexport function _forTo(array, body, check) {\n\tvar i = -1, pact, reject;\n\tfunction _cycle(result) {\n\t\ttry {\n\t\t\twhile (++i < array.length && (!check || !check())) {\n\t\t\t\tresult = body(i);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (pact) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t} else {\n\t\t\t\tpact = result;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t}\n\t}\n\t_cycle();\n\treturn pact;\n}\n\n// Asynchronously iterate through an object's properties (including properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forIn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tkeys.push(key);\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\n// Asynchronously iterate through an object's own properties (excluding properties inherited from the prototype)\n// Uses a snapshot of the object's properties\nexport function _forOwn(target, body, check) {\n\tvar keys = [];\n\tfor (var key in target) {\n\t\tif (Object.prototype.hasOwnProperty.call(target, key)) {\n\t\t\tkeys.push(key);\n\t\t}\n\t}\n\treturn _forTo(keys, function(i) { return body(keys[i]); }, check);\n}\n\nexport const _iteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.iterator || (Symbol.iterator = Symbol(\"Symbol.iterator\"))) : \"@@iterator\";\n\n// Asynchronously iterate through an object's values\n// Uses for...of if the runtime supports it, otherwise iterates until length on a copy\nexport function _forOf(target, body, check) {\n\tif (typeof target[_iteratorSymbol] === \"function\") {\n\t\tvar iterator = target[_iteratorSymbol](), step, pact, reject;\n\t\tfunction _cycle(result) {\n\t\t\ttry {\n\t\t\t\twhile (!(step = iterator.next()).done && (!check || !check())) {\n\t\t\t\t\tresult = body(step.value);\n\t\t\t\t\tif (result && result.then) {\n\t\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tresult.then(_cycle, reject || (reject = _settle.bind(null, pact = new _Pact(), 2)));\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (pact) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t} else {\n\t\t\t\t\tpact = result;\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t_settle(pact || (pact = new _Pact()), 2, e);\n\t\t\t}\n\t\t}\n\t\t_cycle();\n\t\tif (iterator.return) {\n\t\t\tvar _fixup = function(value) {\n\t\t\t\ttry {\n\t\t\t\t\tif (!step.done) {\n\t\t\t\t\t\titerator.return();\n\t\t\t\t\t}\n\t\t\t\t} catch(e) {\n\t\t\t\t}\n\t\t\t\treturn value;\n\t\t\t}\n\t\t\tif (pact && pact.then) {\n\t\t\t\treturn pact.then(_fixup, function(e) {\n\t\t\t\t\tthrow _fixup(e);\n\t\t\t\t});\n\t\t\t}\n\t\t\t_fixup();\n\t\t}\n\t\treturn pact;\n\t}\n\t// No support for Symbol.iterator\n\tif (!(\"length\" in target)) {\n\t\tthrow new TypeError(\"Object is not iterable\");\n\t}\n\t// Handle live collections properly\n\tvar values = [];\n\tfor (var i = 0; i < target.length; i++) {\n\t\tvalues.push(target[i]);\n\t}\n\treturn _forTo(values, function(i) { return body(values[i]); }, check);\n}\n\nexport const _asyncIteratorSymbol = /*#__PURE__*/ typeof Symbol !== \"undefined\" ? (Symbol.asyncIterator || (Symbol.asyncIterator = Symbol(\"Symbol.asyncIterator\"))) : \"@@asyncIterator\";\n\n// Asynchronously iterate on a value using it's async iterator if present, or its synchronous iterator if missing\nexport function _forAwaitOf(target, body, check) {\n\tif (typeof target[_asyncIteratorSymbol] === \"function\") {\n\t\tvar pact = new _Pact();\n\t\tvar iterator = target[_asyncIteratorSymbol]();\n\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\treturn pact;\n\t\tfunction _resumeAfterBody(result) {\n\t\t\tif (check && check()) {\n\t\t\t\treturn _settle(pact, 1, iterator.return ? iterator.return().then(function() { return result; }) : result);\n\t\t\t}\n\t\t\titerator.next().then(_resumeAfterNext).then(void 0, _reject);\n\t\t}\n\t\tfunction _resumeAfterNext(step) {\n\t\t\tif (step.done) {\n\t\t\t\t_settle(pact, 1);\n\t\t\t} else {\n\t\t\t\tPromise.resolve(body(step.value)).then(_resumeAfterBody).then(void 0, _reject);\n\t\t\t}\n\t\t}\n\t\tfunction _reject(error) {\n\t\t\t_settle(pact, 2, iterator.return ? iterator.return().then(function() { return error; }) : error);\n\t\t}\n\t}\n\treturn Promise.resolve(_forOf(target, function(value) { return Promise.resolve(value).then(body); }, check));\n}\n\n// Asynchronously implement a generic for loop\nexport function _for(test, update, body) {\n\tvar stage;\n\tfor (;;) {\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t\tif (shouldContinue.then) {\n\t\t\tstage = 0;\n\t\t\tbreak;\n\t\t}\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.s;\n\t\t\t} else {\n\t\t\t\tstage = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (update) {\n\t\t\tvar updateValue = update();\n\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\tstage = 2;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t}\n\tvar pact = new _Pact();\n\tvar reject = _settle.bind(null, pact, 2);\n\t(stage === 0 ? shouldContinue.then(_resumeAfterTest) : stage === 1 ? result.then(_resumeAfterBody) : updateValue.then(_resumeAfterUpdate)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tdo {\n\t\t\tif (update) {\n\t\t\t\tupdateValue = update();\n\t\t\t\tif (updateValue && updateValue.then && !_isSettledPact(updateValue)) {\n\t\t\t\t\tupdateValue.then(_resumeAfterUpdate).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\tshouldContinue = test();\n\t\t\tif (!shouldContinue || (_isSettledPact(shouldContinue) && !shouldContinue.v)) {\n\t\t\t\t_settle(pact, 1, result);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t}\n\t\t} while (!result || !result.then);\n\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterBody(result);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n\tfunction _resumeAfterUpdate() {\n\t\tif (shouldContinue = test()) {\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t} else {\n\t\t\t\t_resumeAfterTest(shouldContinue);\n\t\t\t}\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a do ... while loop\nexport function _do(body, test) {\n\tvar awaitBody;\n\tdo {\n\t\tvar result = body();\n\t\tif (result && result.then) {\n\t\t\tif (_isSettledPact(result)) {\n\t\t\t\tresult = result.v;\n\t\t\t} else {\n\t\t\t\tawaitBody = true;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tvar shouldContinue = test();\n\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\tshouldContinue = shouldContinue.v;\n\t\t}\n\t\tif (!shouldContinue) {\n\t\t\treturn result;\n\t\t}\n\t} while (!shouldContinue.then);\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : shouldContinue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterBody(value) {\n\t\tresult = value;\n\t\tfor (;;) {\n\t\t\tshouldContinue = test();\n\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t}\n\t\t\tif (!shouldContinue) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (shouldContinue.then) {\n\t\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\tresult = result.v;\n\t\t\t\t} else {\n\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterTest(shouldContinue) {\n\t\tif (shouldContinue) {\n\t\t\tdo {\n\t\t\t\tresult = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tif (_isSettledPact(result)) {\n\t\t\t\t\t\tresult = result.v;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tshouldContinue = test();\n\t\t\t\tif (_isSettledPact(shouldContinue)) {\n\t\t\t\t\tshouldContinue = shouldContinue.v;\n\t\t\t\t}\n\t\t\t\tif (!shouldContinue) {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} while (!shouldContinue.then);\n\t\t\tshouldContinue.then(_resumeAfterTest).then(void 0, reject);\n\t\t} else {\n\t\t\t_settle(pact, 1, result);\n\t\t}\n\t}\n}\n\n// Asynchronously implement a switch statement\nexport function _switch(discriminant, cases) {\n\tvar dispatchIndex = -1;\n\tvar awaitBody;\n\touter: {\n\t\tfor (var i = 0; i < cases.length; i++) {\n\t\t\tvar test = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvar testValue = test();\n\t\t\t\tif (testValue && testValue.then) {\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tif (testValue === discriminant) {\n\t\t\t\t\tdispatchIndex = i;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Found the default case, set it as the pending dispatch case\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tif (dispatchIndex !== -1) {\n\t\t\tdo {\n\t\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\t\twhile (!body) {\n\t\t\t\t\tdispatchIndex++;\n\t\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t\t}\n\t\t\t\tvar result = body();\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tawaitBody = true;\n\t\t\t\t\tbreak outer;\n\t\t\t\t}\n\t\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\t\tdispatchIndex++;\n\t\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t\treturn result;\n\t\t}\n\t}\n\tconst pact = new _Pact();\n\tconst reject = _settle.bind(null, pact, 2);\n\t(awaitBody ? result.then(_resumeAfterBody) : testValue.then(_resumeAfterTest)).then(void 0, reject);\n\treturn pact;\n\tfunction _resumeAfterTest(value) {\n\t\tfor (;;) {\n\t\t\tif (value === discriminant) {\n\t\t\t\tdispatchIndex = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (++i === cases.length) {\n\t\t\t\tif (dispatchIndex !== -1) {\n\t\t\t\t\tbreak;\n\t\t\t\t} else {\n\t\t\t\t\t_settle(pact, 1, result);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t\ttest = cases[i][0];\n\t\t\tif (test) {\n\t\t\t\tvalue = test();\n\t\t\t\tif (value && value.then) {\n\t\t\t\t\tvalue.then(_resumeAfterTest).then(void 0, reject);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tdispatchIndex = i;\n\t\t\t}\n\t\t}\n\t\tdo {\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tvar result = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tdispatchIndex++;\n\t\t} while (fallthroughCheck && !fallthroughCheck());\n\t\t_settle(pact, 1, result);\n\t}\n\tfunction _resumeAfterBody(result) {\n\t\tfor (;;) {\n\t\t\tvar fallthroughCheck = cases[dispatchIndex][2];\n\t\t\tif (!fallthroughCheck || fallthroughCheck()) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdispatchIndex++;\n\t\t\tvar body = cases[dispatchIndex][1];\n\t\t\twhile (!body) {\n\t\t\t\tdispatchIndex++;\n\t\t\t\tbody = cases[dispatchIndex][1];\n\t\t\t}\n\t\t\tresult = body();\n\t\t\tif (result && result.then) {\n\t\t\t\tresult.then(_resumeAfterBody).then(void 0, reject);\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\t_settle(pact, 1, result);\n\t}\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _call(body, then, direct) {\n\tif (direct) {\n\t\treturn then ? then(body()) : body();\n\t}\n\ttry {\n\t\tvar result = Promise.resolve(body());\n\t\treturn then ? result.then(then) : result;\n\t} catch (e) {\n\t\treturn Promise.reject(e);\n\t}\n}\n\n// Asynchronously call a function and swallow the result\nexport function _callIgnored(body, direct) {\n\treturn _call(body, _empty, direct);\n}\n\n// Asynchronously call a function and pass the result to explicitly passed continuations\nexport function _invoke(body, then) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(then);\n\t}\n\treturn then(result);\n}\n\n// Asynchronously call a function and swallow the result\nexport function _invokeIgnored(body) {\n\tvar result = body();\n\tif (result && result.then) {\n\t\treturn result.then(_empty);\n\t}\n}\n\n// Asynchronously call a function and send errors to recovery continuation\nexport function _catch(body, recover) {\n\ttry {\n\t\tvar result = body();\n\t} catch(e) {\n\t\treturn recover(e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(void 0, recover);\n\t}\n\treturn result;\n}\n\n// Asynchronously await a promise and pass the result to a finally continuation\nexport function _finallyRethrows(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer(true, e);\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer.bind(null, false), finalizer.bind(null, true));\n\t}\n\treturn finalizer(false, result);\n}\n\n// Asynchronously await a promise and invoke a finally continuation that always overrides the result\nexport function _finally(body, finalizer) {\n\ttry {\n\t\tvar result = body();\n\t} catch (e) {\n\t\treturn finalizer();\n\t}\n\tif (result && result.then) {\n\t\treturn result.then(finalizer, finalizer);\n\t}\n\treturn finalizer();\n}\n\n// Rethrow or return a value from a finally continuation\nexport function _rethrow(thrown, value) {\n\tif (thrown)\n\t\tthrow value;\n\treturn value;\n}\n\n// Empty function to implement break and other control flow that ignores asynchronous results\nexport function _empty() {\n}\n\n// Sentinel value for early returns in generators \nexport const _earlyReturn = /*#__PURE__*/ {};\n\n// Asynchronously call a function and send errors to recovery continuation, skipping early returns\nexport function _catchInGenerator(body, recover) {\n\treturn _catch(body, function(e) {\n\t\tif (e === _earlyReturn) {\n\t\t\tthrow e;\n\t\t}\n\t\treturn recover(e);\n\t});\n}\n\n// Asynchronous generator class; accepts the entrypoint of the generator, to which it passes itself when the generator should start\nexport const _AsyncGenerator = /*#__PURE__*/(function() {\n\tfunction _AsyncGenerator(entry) {\n\t\tthis._entry = entry;\n\t\tthis._pact = null;\n\t\tthis._resolve = null;\n\t\tthis._return = null;\n\t\tthis._promise = null;\n\t}\n\n\tfunction _wrapReturnedValue(value) {\n\t\treturn { value: value, done: true };\n\t}\n\tfunction _wrapYieldedValue(value) {\n\t\treturn { value: value, done: false };\n\t}\n\n\t_AsyncGenerator.prototype._yield = function(value) {\n\t\t// Yield the value to the pending next call\n\t\tthis._resolve(value && value.then ? value.then(_wrapYieldedValue) : _wrapYieldedValue(value));\n\t\t// Return a pact for an upcoming next/return/throw call\n\t\treturn this._pact = new _Pact();\n\t};\n\t_AsyncGenerator.prototype.next = function(value) {\n\t\t// Advance the generator, starting it if it has yet to be started\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tconst _entry = _this._entry;\n\t\t\t\tif (_entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the next call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Start the generator\n\t\t\t\t_this._entry = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\tfunction returnValue(value) {\n\t\t\t\t\t_this._resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t_this._resolve = null;\n\t\t\t\t}\n\t\t\t\tvar result = _entry(_this);\n\t\t\t\tif (result && result.then) {\n\t\t\t\t\tresult.then(returnValue, function(error) {\n\t\t\t\t\t\tif (error === _earlyReturn) {\n\t\t\t\t\t\t\treturnValue(_this._return);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst pact = new _Pact();\n\t\t\t\t\t\t\t_this._resolve(pact);\n\t\t\t\t\t\t\t_this._pact = null;\n\t\t\t\t\t\t\t_this._resolve = null;\n\t\t\t\t\t\t\t_resolve(pact, 2, error);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\treturnValue(result);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Generator is started and a yield expression is pending, settle it\n\t\t\t\t_this._pact = null;\n\t\t\t\t_this._resolve = resolve;\n\t\t\t\t_settle(_pact, 1, value);\n\t\t\t}\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.return = function(value) {\n\t\t// Early return from the generator if started, otherwise abandons the generator\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the return call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return the specified value\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn resolve(value && value.then ? value.then(_wrapReturnedValue) : _wrapReturnedValue(value));\n\t\t\t}\n\t\t\t// Settle the yield expression with a rejected \"early return\" value\n\t\t\t_this._return = value;\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, _earlyReturn);\n\t\t});\n\t};\n\t_AsyncGenerator.prototype.throw = function(error) {\n\t\t// Inject an exception into the pending yield expression\n\t\tconst _this = this;\n\t\treturn _this._promise = new Promise(function (resolve, reject) {\n\t\t\tconst _pact = _this._pact;\n\t\t\tif (_pact === null) {\n\t\t\t\tif (_this._entry === null) {\n\t\t\t\t\t// Generator is started, but not awaiting a yield expression\n\t\t\t\t\t// Abandon the throw call!\n\t\t\t\t\treturn resolve(_this._promise);\n\t\t\t\t}\n\t\t\t\t// Generator is not started, abandon it and return a rejected Promise containing the error\n\t\t\t\t_this._entry = null;\n\t\t\t\treturn reject(error);\n\t\t\t}\n\t\t\t// Settle the yield expression with the value as a rejection\n\t\t\t_this._resolve = resolve;\n\t\t\t_this._pact = null;\n\t\t\t_settle(_pact, 2, error);\n\t\t});\n\t};\n\n\t_AsyncGenerator.prototype[_asyncIteratorSymbol] = function() {\n\t\treturn this;\n\t};\n\t\n\treturn _AsyncGenerator;\n})();\n","import {\n  AudioTrack,\n  Participant,\n  RemoteTrack,\n  Room,\n  RoomEvent,\n  Track,\n  RoomOptions,\n  RoomConnectOptions,\n} from \"livekit-client\";\nimport { useCallback, useState } from \"react\";\n\nexport interface RoomState {\n  connect: (\n    url: string,\n    token: string,\n    options?: RoomConnectOptions\n  ) => Promise<Room | undefined>;\n  isConnecting: boolean;\n  room?: Room;\n  /* all participants in the room, including the local participant. */\n  participants: Participant[];\n  /* all subscribed audio tracks in the room, not including local participant. */\n  audioTracks: AudioTrack[];\n  error?: Error;\n}\n\nexport function useRoom(roomOptions?: RoomOptions): RoomState {\n  const [currentRoom, setCurrentRoom] = useState<Room>();\n  const [isConnecting, setIsConnecting] = useState(false);\n  const [error, setError] = useState<Error>();\n  const [participants, setParticipants] = useState<Participant[]>([]);\n  const [audioTracks, setAudioTracks] = useState<AudioTrack[]>([]);\n\n  const connectFn = useCallback(\n    async (url: string, token: string, options?: RoomConnectOptions) => {\n      setIsConnecting(true);\n      try {\n        const room = new Room(roomOptions);\n        await room.connect(url, token, options);\n        setCurrentRoom(room);\n        const onParticipantsChanged = () => {\n          const remotes = Array.from(room.participants.values());\n          const participants: Participant[] = [room.localParticipant];\n          participants.push(...remotes);\n          setParticipants(participants);\n        };\n        const onSubscribedTrackChanged = (track?: RemoteTrack) => {\n          // ordering may have changed, re-sort\n          onParticipantsChanged();\n          if (track && track.kind !== Track.Kind.Audio) {\n            return;\n          }\n          const tracks: AudioTrack[] = [];\n          room.participants.forEach((p) => {\n            p.audioTracks.forEach((pub) => {\n              if (pub.audioTrack) {\n                tracks.push(pub.audioTrack);\n              }\n            });\n          });\n          setAudioTracks(tracks);\n        };\n\n        room.once(RoomEvent.Disconnected, () => {\n          setTimeout(() => setCurrentRoom(undefined));\n\n          room\n            .off(RoomEvent.ParticipantConnected, onParticipantsChanged)\n            .off(RoomEvent.ParticipantDisconnected, onParticipantsChanged)\n            .off(RoomEvent.ActiveSpeakersChanged, onParticipantsChanged)\n            .off(RoomEvent.TrackSubscribed, onSubscribedTrackChanged)\n            .off(RoomEvent.TrackUnsubscribed, onSubscribedTrackChanged)\n            .off(RoomEvent.LocalTrackPublished, onParticipantsChanged)\n            .off(RoomEvent.LocalTrackUnpublished, onParticipantsChanged)\n            .off(RoomEvent.AudioPlaybackStatusChanged, onParticipantsChanged);\n        });\n        room\n          .on(RoomEvent.ParticipantConnected, onParticipantsChanged)\n          .on(RoomEvent.ParticipantDisconnected, onParticipantsChanged)\n          .on(RoomEvent.ActiveSpeakersChanged, onParticipantsChanged)\n          .on(RoomEvent.TrackSubscribed, onSubscribedTrackChanged)\n          .on(RoomEvent.TrackUnsubscribed, onSubscribedTrackChanged)\n          .on(RoomEvent.LocalTrackPublished, onParticipantsChanged)\n          .on(RoomEvent.LocalTrackUnpublished, onParticipantsChanged)\n          // trigger a state change by re-sorting participants\n          .on(RoomEvent.AudioPlaybackStatusChanged, onParticipantsChanged);\n\n        setIsConnecting(false);\n        onSubscribedTrackChanged();\n\n        return room;\n      } catch (error) {\n        setIsConnecting(false);\n        if (error instanceof Error) {\n          setError(error);\n        } else {\n          setError(new Error(\"an error has occured\"));\n        }\n\n        return undefined;\n      }\n    },\n    []\n  );\n\n  return {\n    connect: connectFn,\n    isConnecting,\n    room: currentRoom,\n    error,\n    participants,\n    audioTracks,\n  };\n}\n","import { Room, RoomConnectOptions, RoomOptions } from \"livekit-client\";\nimport React, { useEffect } from \"react\";\nimport { ControlsProps } from \"./components/ControlsView\";\nimport { ParticipantProps } from \"./components/ParticipantView\";\nimport { StageProps } from \"./components/StageProps\";\nimport { StageView } from \"./components/StageView\";\nimport { useRoom } from \"./useRoom\";\n\nexport interface RoomProps {\n  url: string;\n  token: string;\n  roomOptions?: RoomOptions;\n  connectOptions?: RoomConnectOptions;\n  // when first connected to room\n  onConnected?: (room: Room) => void;\n  // when user leaves the room\n  onLeave?: (room: Room) => void;\n  stageRenderer?: (props: StageProps) => React.ReactElement | null;\n  participantRenderer?: (props: ParticipantProps) => React.ReactElement | null;\n  controlRenderer?: (props: ControlsProps) => React.ReactElement | null;\n}\n\nexport const LiveKitRoom = ({\n  url,\n  token,\n  roomOptions,\n  connectOptions,\n  stageRenderer,\n  participantRenderer,\n  controlRenderer,\n  onConnected,\n  onLeave,\n}: RoomProps) => {\n  const roomState = useRoom(roomOptions);\n\n  useEffect(() => {\n    roomState.connect(url, token, connectOptions).then((room) => {\n      if (!room) {\n        return;\n      }\n      if (onConnected) {\n        onConnected(room);\n      }\n    });\n  }, []);\n\n  const selectedStageRenderer = stageRenderer ?? StageView;\n\n  return selectedStageRenderer({\n    roomState,\n    participantRenderer,\n    controlRenderer,\n    onLeave,\n  });\n};\n"],"names":["AudioRenderer","track","isLocal","audioEl","useRef","useEffect","current","attach","sid","setAttribute","detach","forEach","el","remove","ControlButton","label","disabled","onClick","icon","className","menuItems","popoverContainerClassName","popoverTriggerBtnClassName","popoverTriggerBtnSeparatorClassName","onMenuItemClick","useState","menuVisible","setMenuVisible","classes","styles","button","handleMenuClick","item","menuTrigger","menu","React","length","hasDropdown","dropdown","separator","FontAwesomeIcon","height","faChevronDown","popoverMenu","list","map","i","key","mainContent","Popover","isOpen","positions","content","buttonWrapper","AudioSelectButton","isMuted","onSourceSelected","isButtonDisabled","muteText","unmuteText","sources","setSources","setMenuItems","listAudioDevices","useCallback","Room","getLocalDevices","devices","navigator","mediaDevices","addEventListener","removeEventListener","handleMenuItem","device","find","d","faMicrophoneSlash","faMicrophone","useParticipant","participant","isAudioMuted","setAudioMuted","setVideoMuted","connectionQuality","setConnectionQuality","isSpeaking","setSpeaking","metadata","setMetadata","publications","setPublications","subscribedTracks","setSubscribedTracks","onPublicationsChanged","Array","from","tracks","values","filter","pub","isSubscribed","undefined","onMuted","kind","Track","Kind","Audio","Video","onUnmuted","onMetadataChanged","onIsSpeakingChanged","onConnectionQualityUpdate","on","ParticipantEvent","TrackMuted","TrackUnmuted","ParticipantMetadataChanged","IsSpeakingChanged","TrackPublished","TrackUnpublished","TrackSubscribed","TrackUnsubscribed","LocalTrackPublished","LocalTrackUnpublished","ConnectionQualityChanged","off","muted","audioTracks","LocalParticipant","cameraPublication","getTrack","Source","Camera","microphonePublication","Microphone","screenSharePublication","ScreenShare","VideoSelectButton","isEnabled","disableText","enableText","listVideoDevices","faVideo","faVideoSlash","ControlsView","room","enableScreenShare","enableAudio","enableVideo","onLeave","localParticipant","camPub","audioButtonDisabled","setAudioButtonDisabled","muteButton","enabled","isMicrophoneEnabled","setMicrophoneEnabled","switchActiveDevice","deviceId","videoButtonDisabled","setVideoButtonDisabled","videoButton","setCameraEnabled","screenButtonDisabled","setScreenButtonDisabled","screenButton","isScreenShareEnabled","faStop","faDesktop","setScreenShareEnabled","controlsWrapper","dangerButton","disconnect","DisplayContext","createContext","stageLayout","showStats","VideoRenderer","objectFit","onSizeChanged","width","ref","handleResize","ev","target","HTMLVideoElement","videoWidth","videoHeight","isFrontFacing","mediaStreamTrack","getSettings","facingMode","style","transform","video","ParticipantView","speakerClassName","aspectWidth","aspectHeight","orientation","displayName","showOverlay","showConnectionQuality","onMouseEnter","onMouseLeave","videoSize","setVideoSize","currentBitrate","setCurrentBitrate","context","useContext","interval","setInterval","total","LocalTrack","RemoteTrack","clearInterval","containerStyles","videoOrientation","dimensions","name","identity","mainElement","placeholder","push","speaker","statsContent","stats","Math","round","ConnectionQualityIndicator","ConnectionQuality","Excellent","connectionQuality3","Good","connectionQuality2","Poor","connectionQuality1","join","AspectRatio","ratio","participantBar","center","iconRed","iconNormal","ScreenShareView","screenShare","GridStage","roomState","participantRenderer","controlRenderer","isConnecting","error","participants","visibleParticipants","setVisibleParticipants","setShowOverlay","grid1x1","gridClass","setGridClass","numVisible","grid2x1","grid2x2","min","grid3x3","grid4x4","grid5x5","newParticipants","p","has","activeSpeakers","includes","idx","findIndex","splice","message","ParticipantRenderer","ControlRenderer","container","gridStage","controlsArea","defaultSortParticipants","sortedParticipants","sort","a","b","audioLevel","lastSpokeAt","aLast","getTime","bLast","aVideo","videoTracks","size","bVideo","joinedAt","localIdx","indexOf","SpeakerStage","sortParticipants","sortFn","setSortedParticipants","screenTrack","videoTrack","otherParticipants","mainView","stage","stageCenter","sidebar","MobileStage","participantsArea","StageView","stageProps","isMobile","useMediaQuery","query","canPlaybackAudio","overlay","unmuteButton","startAudio","faVolumeMute","useRoom","roomOptions","currentRoom","setCurrentRoom","setIsConnecting","setError","setParticipants","setAudioTracks","connectFn","url","token","options","connect","onParticipantsChanged","remotes","onSubscribedTrackChanged","audioTrack","once","RoomEvent","Disconnected","setTimeout","ParticipantConnected","ParticipantDisconnected","ActiveSpeakersChanged","AudioPlaybackStatusChanged","Error","LiveKitRoom","connectOptions","stageRenderer","onConnected","then","selectedStageRenderer"],"mappings":";;;;;;;;IAQaA,aAAa,GAAG,SAAhBA,aAAgB;MAAGC,aAAAA;MAAOC,eAAAA;AACrC,MAAMC,OAAO,GAAGC,MAAM,EAAtB;AAEAC,EAAAA,SAAS,CAAC;AACR,QAAIH,OAAJ,EAAa;AAEX;AACD;;AACDC,IAAAA,OAAO,CAACG,OAAR,GAAkBL,KAAK,CAACM,MAAN,EAAlB;;AACA,QAAIN,KAAK,CAACO,GAAV,EAAe;AACbL,MAAAA,OAAO,CAACG,OAAR,CAAgBG,YAAhB,CAA6B,qBAA7B,EAAoDR,KAAK,CAACO,GAA1D;AACD;;AACD,WAAO;AAAA,aAAMP,KAAK,CAACS,MAAN,GAAeC,OAAf,CAAuB,UAACC,EAAD;AAAA,eAAQA,EAAE,CAACC,MAAH,EAAR;AAAA,OAAvB,CAAN;AAAA,KAAP;AACD,GAVQ,EAUN,CAACZ,KAAD,EAAQC,OAAR,CAVM,CAAT;AAaA,SAAO,IAAP;AACD;;;;ICCYY,aAAa,GAAG,SAAhBA,aAAgB;MAC3BC,aAAAA;MACAC,gBAAAA;MACAC,gBAAAA;MACAC,YAAAA;MACAC,iBAAAA;MACAC,iBAAAA;MACAC,iCAAAA;MACAC,kCAAAA;MACAC,2CAAAA;MACAC,uBAAAA;;AAEA,kBAAsCC,QAAQ,CAAC,KAAD,CAA9C;AAAA,MAAOC,WAAP;AAAA,MAAoBC,cAApB;;AAEA,MAAIC,OAAO,GAAGC,MAAM,CAACC,MAArB;;AACA,MAAIX,SAAJ,EAAe;AACbS,IAAAA,OAAO,UAAQT,SAAf;AACD;;AAED,MAAMY,eAAe,GAAG,SAAlBA,eAAkB,CAACC,IAAD;AACtBL,IAAAA,cAAc,CAAC,KAAD,CAAd;;AACA,QAAIH,eAAJ,EAAqB;AACnBA,MAAAA,eAAe,CAACQ,IAAD,CAAf;AACD;AACF,GALD;;AAOA,MAAIC,WAAJ;AACA,MAAIC,IAAI,GAAiBC,4BAAA,MAAA,MAAA,CAAzB;;AACA,MAAIf,SAAS,IAAIA,SAAS,CAACgB,MAAV,GAAmB,CAApC,EAAuC;AACrCR,IAAAA,OAAO,UAAQC,MAAM,CAACQ,WAAtB;AACAJ,IAAAA,WAAW,GACTE,4BAAA,SAAA;AACEnB,MAAAA,QAAQ,EAAEA;AACVG,MAAAA,SAAS,EAAKU,MAAM,CAACC,MAAZ,SAAsBR,0BAAtB,UAAqDO,MAAM,CAACS;AACrErB,MAAAA,OAAO,EAAE;AAAA,eAAMU,cAAc,CAAC,CAACD,WAAF,CAApB;AAAA;KAHX,EAKES,4BAAA,MAAA;AACEhB,MAAAA,SAAS,EAAKU,MAAM,CAACU,SAAZ,SAAyBhB;KADpC,CALF,EAQEY,4BAAA,CAACK,eAAD;AAAiBC,MAAAA,MAAM,EAAE;AAAIvB,MAAAA,IAAI,EAAEwB;KAAnC,CARF,CADF;AAaAR,IAAAA,IAAI,GACFC,4BAAA,MAAA;AAAKhB,MAAAA,SAAS,EAAKU,MAAM,CAACc,WAAZ,SAA2BtB;KAAzC,EACEc,4BAAA,KAAA;AAAIhB,MAAAA,SAAS,EAAEU,MAAM,CAACe;KAAtB,EACGxB,SADH,aACGA,SADH,uBACGA,SAAS,CAAEyB,GAAX,CAAe,UAACb,IAAD,EAAOc,CAAP;AACd,aACEX,4BAAA,KAAA;AAAIY,QAAAA,GAAG,EAAED;AAAG7B,QAAAA,OAAO,EAAE;AAAA,iBAAMc,eAAe,CAACC,IAAD,CAArB;AAAA;OAArB,EACGA,IAAI,CAACjB,KADR,CADF;AAKD,KANA,CADH,CADF,CADF;AAaD;;AAED,MAAMiC,WAAW,GACfb,4BAAA,SAAA;AACEnB,IAAAA,QAAQ,EAAEA;AACVG,IAAAA,SAAS,EAAES;AACXX,IAAAA,OAAO,EAAE;AACPU,MAAAA,cAAc,CAAC,KAAD,CAAd;AACA,UAAIV,QAAJ,EAAaA,QAAO;AACrB;GANH,EAQGC,IAAI,IACHiB,4BAAA,CAACK,eAAD;AAAiBrB,IAAAA,SAAS,EAAEU,MAAM,CAACX;AAAMuB,IAAAA,MAAM,EAAE;AAAIvB,IAAAA,IAAI,EAAEA;GAA3D,CATJ,EAWGH,KAXH,CADF;;AAgBA,MAAI,CAACkB,WAAL,EAAkB;AAChB,WAAOe,WAAP;AACD;;AAED,SACEb,4BAAA,CAACc,OAAD;AAASC,IAAAA,MAAM,EAAExB;AAAayB,IAAAA,SAAS,EAAE,CAAC,KAAD;AAASC,IAAAA,OAAO,EAAElB;GAA3D,EACEC,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,MAAM,CAACwB;GAAvB,EACGL,WADH,EAEGf,WAFH,CADF,CADF;AAQD,CAtFM;;ICLMqB,iBAAiB,GAAG,SAApBA,iBAAoB;MAC/BC,eAAAA;MACAtC,eAAAA;MACAuC,wBAAAA;MACAC,wBAAAA;2BACAC;MAAAA,sCAAW;6BACXC;MAAAA,0CAAa;MACbxC,iBAAAA;MACAE,iCAAAA;MACAC,kCAAAA;MACAC,2CAAAA;;AAEA,kBAA8BE,QAAQ,CAAoB,EAApB,CAAtC;AAAA,MAAOmC,OAAP;AAAA,MAAgBC,UAAhB;;AACA,mBAAkCpC,QAAQ,CAAa,EAAb,CAA1C;AAAA,MAAOL,SAAP;AAAA,MAAkB0C,YAAlB;;AAEA,MAAMC,gBAAgB,GAAGC,WAAW;AAAA;6BACZC,IAAI,CAACC,eAAL,CAAqB,YAArB,kBAAhBC;AACNN,QAAAA,UAAU,CAACM,OAAD,CAAV;AACAL,QAAAA,YAAY,CACVK,OAAO,CAACtB,GAAR,CAAY,UAACb,IAAD;AACV,iBAAO;AAAEjB,YAAAA,KAAK,EAAEiB,IAAI,CAACjB;AAAd,WAAP;AACD,SAFD,CADU,CAAZ;;AAKD,KARmC;AAAA;AAAA;AAAA,KAQjC,EARiC,CAApC;AAUAV,EAAAA,SAAS,CAAC;AACR0D,IAAAA,gBAAgB;AAChBK,IAAAA,SAAS,CAACC,YAAV,CAAuBC,gBAAvB,CAAwC,cAAxC,EAAwDP,gBAAxD;AAEA,WAAO;AACLK,MAAAA,SAAS,CAACC,YAAV,CAAuBE,mBAAvB,CACE,cADF,EAEER,gBAFF;AAID,KALD;AAMD,GAVQ,EAUN,EAVM,CAAT;;AAYA,MAAMS,cAAc,GAAG,SAAjBA,cAAiB,CAACxC,IAAD;AACrB,QAAMyC,MAAM,GAAGb,OAAO,CAACc,IAAR,CAAa,UAACC,CAAD;AAAA,aAAOA,CAAC,CAAC5D,KAAF,KAAYiB,IAAI,CAACjB,KAAxB;AAAA,KAAb,CAAf;;AACA,QAAI0D,MAAM,IAAIjB,gBAAd,EAAgC;AAC9BA,MAAAA,gBAAgB,CAACiB,MAAD,CAAhB;AACD;AACF,GALD;;AAOA,SACEtC,4BAAA,CAACrB,aAAD;AACEC,IAAAA,KAAK,EAAEwC,OAAO,GAAGI,UAAH,GAAgBD;AAC9BxC,IAAAA,IAAI,EAAEqC,OAAO,GAAGqB,iBAAH,GAAuBC;AACpC7D,IAAAA,QAAQ,EAAEyC;AACVxC,IAAAA,OAAO,EAAEA;AACTG,IAAAA,SAAS,EAAEA;AACXI,IAAAA,eAAe,EAAEgD;AACjBrD,IAAAA,SAAS,EAAEA;AACXE,IAAAA,yBAAyB,EAAEA;AAC3BC,IAAAA,0BAA0B,EAAEA;AAC5BC,IAAAA,mCAAmC,EAAEA;GAVvC,CADF;AAcD,CA1DM;;SCCSuD,eAAeC;AAC7B,kBAAsCtD,QAAQ,CAAC,KAAD,CAA9C;AAAA,MAAOuD,YAAP;AAAA,MAAqBC,aAArB;;AACA,mBAA0BxD,QAAQ,CAAC,KAAD,CAAlC;AAAA,MAASyD,aAAT;;AACA,mBAAkDzD,QAAQ,CACxDsD,WAAW,CAACI,iBAD4C,CAA1D;AAAA,MAAOA,iBAAP;AAAA,MAA0BC,oBAA1B;;AAGA,mBAAkC3D,QAAQ,CAAC,KAAD,CAA1C;AAAA,MAAO4D,UAAP;AAAA,MAAmBC,WAAnB;;AACA,mBAAgC7D,QAAQ,EAAxC;AAAA,MAAO8D,QAAP;AAAA,MAAiBC,WAAjB;;AACA,mBAAwC/D,QAAQ,CAAqB,EAArB,CAAhD;AAAA,MAAOgE,YAAP;AAAA,MAAqBC,eAArB;;AACA,mBAAgDjE,QAAQ,CACtD,EADsD,CAAxD;AAAA,MAAOkE,gBAAP;AAAA,MAAyBC,mBAAzB;;AAIA,MAAMC,qBAAqB,GAAG,SAAxBA,qBAAwB;AAC5BH,IAAAA,eAAe,CAACI,KAAK,CAACC,IAAN,CAAWhB,WAAW,CAACiB,MAAZ,CAAmBC,MAAnB,EAAX,CAAD,CAAf;AACAL,IAAAA,mBAAmB,CACjBE,KAAK,CAACC,IAAN,CAAWhB,WAAW,CAACiB,MAAZ,CAAmBC,MAAnB,EAAX,EAAwCC,MAAxC,CAA+C,UAACC,GAAD;AAC7C,aAAOA,GAAG,CAACC,YAAJ,IAAoBD,GAAG,CAAClG,KAAJ,KAAcoG,SAAzC;AACD,KAFD,CADiB,CAAnB;AAKD,GAPD;;AASAhG,EAAAA,SAAS,CAAC;AACR,QAAMiG,OAAO,GAAG,SAAVA,OAAU,CAACH,GAAD;AACd,UAAIA,GAAG,CAACI,IAAJ,KAAaC,KAAK,CAACC,IAAN,CAAWC,KAA5B,EAAmC;AACjCzB,QAAAA,aAAa,CAAC,IAAD,CAAb;AACD,OAFD,MAEO,IAAIkB,GAAG,CAACI,IAAJ,KAAaC,KAAK,CAACC,IAAN,CAAWE,KAA5B,EAAmC;AACxCzB,QAAAA,aAAa,CAAC,IAAD,CAAb;AACD;AACF,KAND;;AAOA,QAAM0B,SAAS,GAAG,SAAZA,SAAY,CAACT,GAAD;AAChB,UAAIA,GAAG,CAACI,IAAJ,KAAaC,KAAK,CAACC,IAAN,CAAWC,KAA5B,EAAmC;AACjCzB,QAAAA,aAAa,CAAC,KAAD,CAAb;AACD,OAFD,MAEO,IAAIkB,GAAG,CAACI,IAAJ,KAAaC,KAAK,CAACC,IAAN,CAAWE,KAA5B,EAAmC;AACxCzB,QAAAA,aAAa,CAAC,KAAD,CAAb;AACD;AACF,KAND;;AAOA,QAAM2B,iBAAiB,GAAG,SAApBA,iBAAoB;AACxB,UAAI9B,WAAW,CAACQ,QAAhB,EAA0B;AACxBC,QAAAA,WAAW,CAACT,WAAW,CAACQ,QAAb,CAAX;AACD;AACF,KAJD;;AAKA,QAAMuB,mBAAmB,GAAG,SAAtBA,mBAAsB;AAC1BxB,MAAAA,WAAW,CAACP,WAAW,CAACM,UAAb,CAAX;AACD,KAFD;;AAGA,QAAM0B,yBAAyB,GAAG,SAA5BA,yBAA4B;AAChC3B,MAAAA,oBAAoB,CAACL,WAAW,CAACI,iBAAb,CAApB;AACD,KAFD;;AAKAJ,IAAAA,WAAW,CACRiC,EADH,CACMC,gBAAgB,CAACC,UADvB,EACmCZ,OADnC,EAEGU,EAFH,CAEMC,gBAAgB,CAACE,YAFvB,EAEqCP,SAFrC,EAGGI,EAHH,CAGMC,gBAAgB,CAACG,0BAHvB,EAGmDP,iBAHnD,EAIGG,EAJH,CAIMC,gBAAgB,CAACI,iBAJvB,EAI0CP,mBAJ1C,EAKGE,EALH,CAKMC,gBAAgB,CAACK,cALvB,EAKuCzB,qBALvC,EAMGmB,EANH,CAMMC,gBAAgB,CAACM,gBANvB,EAMyC1B,qBANzC,EAOGmB,EAPH,CAOMC,gBAAgB,CAACO,eAPvB,EAOwC3B,qBAPxC,EAQGmB,EARH,CAQMC,gBAAgB,CAACQ,iBARvB,EAQ0C5B,qBAR1C,EASGmB,EATH,CASMC,gBAAgB,CAACS,mBATvB,EAS4C7B,qBAT5C,EAUGmB,EAVH,CAUMC,gBAAgB,CAACU,qBAVvB,EAU8C9B,qBAV9C,EAWGmB,EAXH,CAWMC,gBAAgB,CAACW,wBAXvB,EAWiDb,yBAXjD;AAcAF,IAAAA,iBAAiB;AACjBC,IAAAA,mBAAmB;AACnBjB,IAAAA,qBAAqB;AAErB,WAAO;AAELd,MAAAA,WAAW,CACR8C,GADH,CACOZ,gBAAgB,CAACC,UADxB,EACoCZ,OADpC,EAEGuB,GAFH,CAEOZ,gBAAgB,CAACE,YAFxB,EAEsCP,SAFtC,EAGGiB,GAHH,CAGOZ,gBAAgB,CAACG,0BAHxB,EAGoDP,iBAHpD,EAIGgB,GAJH,CAIOZ,gBAAgB,CAACI,iBAJxB,EAI2CP,mBAJ3C,EAKGe,GALH,CAKOZ,gBAAgB,CAACK,cALxB,EAKwCzB,qBALxC,EAMGgC,GANH,CAMOZ,gBAAgB,CAACM,gBANxB,EAM0C1B,qBAN1C,EAOGgC,GAPH,CAOOZ,gBAAgB,CAACO,eAPxB,EAOyC3B,qBAPzC,EAQGgC,GARH,CAQOZ,gBAAgB,CAACQ,iBARxB,EAQ2C5B,qBAR3C,EASGgC,GATH,CASOZ,gBAAgB,CAACS,mBATxB,EAS6C7B,qBAT7C,EAUGgC,GAVH,CAUOZ,gBAAgB,CAACU,qBAVxB,EAU+C9B,qBAV/C,EAWGgC,GAXH,CAYIZ,gBAAgB,CAACW,wBAZrB,EAaIb,yBAbJ;AAeD,KAjBD;AAkBD,GAhEQ,EAgEN,CAAChC,WAAD,CAhEM,CAAT;AAkEA,MAAI+C,KAAJ;AACA/C,EAAAA,WAAW,CAACgD,WAAZ,CAAwBpH,OAAxB,CAAgC,UAACwF,GAAD;AAC9B2B,IAAAA,KAAK,GAAG3B,GAAG,CAAC5C,OAAZ;AACD,GAFD;;AAGA,MAAIuE,KAAK,KAAKzB,SAAd,EAAyB;AACvByB,IAAAA,KAAK,GAAG,IAAR;AACD;;AACD,MAAI9C,YAAY,KAAK8C,KAArB,EAA4B;AAC1B7C,IAAAA,aAAa,CAAC6C,KAAD,CAAb;AACD;;AAED,SAAO;AACL5H,IAAAA,OAAO,EAAE6E,WAAW,YAAYiD,gBAD3B;AAEL3C,IAAAA,UAAU,EAAVA,UAFK;AAGLF,IAAAA,iBAAiB,EAAjBA,iBAHK;AAILM,IAAAA,YAAY,EAAZA,YAJK;AAKLE,IAAAA,gBAAgB,EAAhBA,gBALK;AAMLsC,IAAAA,iBAAiB,EAAElD,WAAW,CAACmD,QAAZ,CAAqB1B,KAAK,CAAC2B,MAAN,CAAaC,MAAlC,CANd;AAOLC,IAAAA,qBAAqB,EAAEtD,WAAW,CAACmD,QAAZ,CAAqB1B,KAAK,CAAC2B,MAAN,CAAaG,UAAlC,CAPlB;AAQLC,IAAAA,sBAAsB,EAAExD,WAAW,CAACmD,QAAZ,CAAqB1B,KAAK,CAAC2B,MAAN,CAAaK,WAAlC,CARnB;AASLjD,IAAAA,QAAQ,EAARA;AATK,GAAP;AAWD;;IClHYkD,iBAAiB,GAAG,SAApBA,iBAAoB;MAC/BC,iBAAAA;MACAzH,eAAAA;MACAuC,wBAAAA;8BACAmF;MAAAA,4CAAc;6BACdC;MAAAA,0CAAa;MACbzH,iBAAAA;MACAsC,wBAAAA;MACApC,iCAAAA;MACAC,kCAAAA;MACAC,2CAAAA;;AAEA,kBAA8BE,QAAQ,CAAoB,EAApB,CAAtC;AAAA,MAAOmC,OAAP;AAAA,MAAgBC,UAAhB;;AACA,mBAAkCpC,QAAQ,CAAa,EAAb,CAA1C;AAAA,MAAOL,SAAP;AAAA,MAAkB0C,YAAlB;;AAEA,MAAM+E,gBAAgB,GAAG7E,WAAW;AAAA;6BACZC,IAAI,CAACC,eAAL,CAAqB,YAArB,kBAAhBC;AACNN,QAAAA,UAAU,CAACM,OAAD,CAAV;AACAL,QAAAA,YAAY,CACVK,OAAO,CAACtB,GAAR,CAAY,UAACb,IAAD;AACV,iBAAO;AAAEjB,YAAAA,KAAK,EAAEiB,IAAI,CAACjB;AAAd,WAAP;AACD,SAFD,CADU,CAAZ;;AAKD,KARmC;AAAA;AAAA;AAAA,KAQjC,EARiC,CAApC;AAUAV,EAAAA,SAAS,CAAC;AACRwI,IAAAA,gBAAgB;AAChBzE,IAAAA,SAAS,CAACC,YAAV,CAAuBC,gBAAvB,CAAwC,cAAxC,EAAwDuE,gBAAxD;AACA,WAAO;AACLzE,MAAAA,SAAS,CAACC,YAAV,CAAuBE,mBAAvB,CACE,cADF,EAEEsE,gBAFF;AAID,KALD;AAMD,GATQ,EASN,EATM,CAAT;;AAWA,MAAMrE,cAAc,GAAG,SAAjBA,cAAiB,CAACxC,IAAD;AACrB,QAAMyC,MAAM,GAAGb,OAAO,CAACc,IAAR,CAAa,UAACC,CAAD;AAAA,aAAOA,CAAC,CAAC5D,KAAF,KAAYiB,IAAI,CAACjB,KAAxB;AAAA,KAAb,CAAf;;AACA,QAAI0D,MAAM,IAAIjB,gBAAd,EAAgC;AAC9BA,MAAAA,gBAAgB,CAACiB,MAAD,CAAhB;AACD;AACF,GALD;;AAOA,SACEtC,4BAAA,CAACrB,aAAD;AACEC,IAAAA,KAAK,EAAE2H,SAAS,GAAGC,WAAH,GAAiBC;AACjC1H,IAAAA,IAAI,EAAEwH,SAAS,GAAGI,OAAH,GAAaC;AAC5B/H,IAAAA,QAAQ,EAAEyC;AACVxC,IAAAA,OAAO,EAAEA;AACTG,IAAAA,SAAS,EAAEA;AACXI,IAAAA,eAAe,EAAEgD;AACjBrD,IAAAA,SAAS,EAAEA;AACXE,IAAAA,yBAAyB,EAAEA;AAC3BC,IAAAA,0BAA0B,EAAEA;AAC5BC,IAAAA,mCAAmC,EAAEA;GAVvC,CADF;AAcD,CAzDM;;ICDMyH,YAAY,GAAG,SAAfA,YAAe;MAC1BC,YAAAA;MACAC,yBAAAA;MACAC,mBAAAA;MACAC,mBAAAA;MACAC,eAAAA;;AAEA,wBAAsCvE,cAAc,CAACmE,IAAI,CAACK,gBAAN,CAApD;AAAA,MAA2BC,MAA3B,mBAAQtB,iBAAR;;AAEA,MAAIiB,iBAAiB,KAAK7C,SAA1B,EAAqC;AACnC6C,IAAAA,iBAAiB,GAAG,IAApB;AACD;;AACD,MAAIE,WAAW,KAAK/C,SAApB,EAA+B;AAC7B+C,IAAAA,WAAW,GAAG,IAAd;AACD;;AACD,MAAID,WAAW,KAAK9C,SAApB,EAA+B;AAC7B8C,IAAAA,WAAW,GAAG,IAAd;AACD;;AAED,wBAAsDhH,cAAK,CAACV,QAAN,CAAe,KAAf,CAAtD;AAAA,MAAO+H,mBAAP;AAAA,MAA4BC,sBAA5B;;AACA,MAAIC,UAAJ;;AACA,MAAIP,WAAJ,EAAiB;AACf,QAAMQ,OAAO,GAAGV,IAAI,CAACK,gBAAL,CAAsBM,mBAAtC;AACAF,IAAAA,UAAU,GACRvH,4BAAA,CAACmB,iBAAD;AACEC,MAAAA,OAAO,EAAE,CAACoG;AACVlG,MAAAA,gBAAgB,EAAE+F;AAClBvI,MAAAA,OAAO;AAAA;AACLwI,UAAAA,sBAAsB,CAAC,IAAD,CAAtB;AACAR,UAAAA,IAAI,CAACK,gBAAL,CACGO,oBADH,CACwB,CAACF,OADzB,aAEW;AAAA,mBAAMF,sBAAsB,CAAC,KAAD,CAA5B;AAAA,WAFX;;AAGD,SALM;AAAA;AAAA;AAAA;AAMPjG,MAAAA,gBAAgB,EAAE,0BAACiB,MAAD;AAChBgF,QAAAA,sBAAsB,CAAC,IAAD,CAAtB;AACAR,QAAAA,IAAI,CACDa,kBADH,CACsB,YADtB,EACoCrF,MAAM,CAACsF,QAD3C,aAEW;AAAA,iBAAMN,sBAAsB,CAAC,KAAD,CAA5B;AAAA,SAFX;AAGD;KAdH,CADF;AAkBD;;AAED,yBAAsDtH,cAAK,CAACV,QAAN,CAAe,KAAf,CAAtD;AAAA,MAAOuI,mBAAP;AAAA,MAA4BC,sBAA5B;;AAEA,MAAIC,WAAJ;;AACA,MAAId,WAAJ,EAAiB;AAAA;;AACf,QAAMO,QAAO,GAAG,qBAAEJ,MAAF,aAAEA,MAAF,uBAAEA,MAAM,CAAEhG,OAAV,8BAAqB,IAArB,CAAhB;;AACA2G,IAAAA,WAAW,GACT/H,4BAAA,CAACsG,iBAAD;AACEC,MAAAA,SAAS,EAAEiB;AACXlG,MAAAA,gBAAgB,EAAEuG;AAClB/I,MAAAA,OAAO,EAAE;AACPgJ,QAAAA,sBAAsB,CAAC,IAAD,CAAtB;AACAhB,QAAAA,IAAI,CAACK,gBAAL,CACGa,gBADH,CACoB,CAACR,QADrB,aAEW;AAAA,iBAAMM,sBAAsB,CAAC,KAAD,CAA5B;AAAA,SAFX;AAGD;AACDzG,MAAAA,gBAAgB,EAAE,0BAACiB,MAAD;AAChBwF,QAAAA,sBAAsB,CAAC,IAAD,CAAtB;AACAhB,QAAAA,IAAI,CACDa,kBADH,CACsB,YADtB,EACoCrF,MAAM,CAACsF,QAD3C,aAEW;AAAA,iBAAME,sBAAsB,CAAC,KAAD,CAA5B;AAAA,SAFX;AAGD;KAdH,CADF;AAkBD;;AAED,yBAAwD9H,cAAK,CAACV,QAAN,CAAe,KAAf,CAAxD;AAAA,MAAO2I,oBAAP;AAAA,MAA6BC,uBAA7B;;AACA,MAAIC,YAAJ;;AACA,MAAIpB,iBAAJ,EAAuB;AACrB,QAAMS,SAAO,GAAGV,IAAI,CAACK,gBAAL,CAAsBiB,oBAAtC;AACAD,IAAAA,YAAY,GACVnI,4BAAA,CAACrB,aAAD;AACEC,MAAAA,KAAK,EAAE4I,SAAO,GAAG,cAAH,GAAoB;AAClCzI,MAAAA,IAAI,EAAEyI,SAAO,GAAGa,MAAH,GAAYC;AACzBzJ,MAAAA,QAAQ,EAAEoJ;AACVnJ,MAAAA,OAAO,EAAE;AACPoJ,QAAAA,uBAAuB,CAAC,IAAD,CAAvB;AACApB,QAAAA,IAAI,CAACK,gBAAL,CACGoB,qBADH,CACyB,CAACf,SAD1B,aAEW;AAAA,iBAAMU,uBAAuB,CAAC,KAAD,CAA7B;AAAA,SAFX;AAGD;KATH,CADF;AAaD;;AAED,SACElI,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,MAAM,CAAC8I;GAAvB,EACGjB,UADH,EAEGQ,WAFH,EAGGI,YAHH,EAIGjB,OAAO,IACNlH,4BAAA,CAACrB,aAAD;AACEC,IAAAA,KAAK,EAAC;AACNI,IAAAA,SAAS,EAAEU,MAAM,CAAC+I;AAClB3J,IAAAA,OAAO,EAAE;AACPgI,MAAAA,IAAI,CAAC4B,UAAL;AACAxB,MAAAA,OAAO,CAACJ,IAAD,CAAP;AACD;GANH,CALJ,CADF;AAiBD,CAxGM;;ICTM6B,cAAc,GAAG3I,cAAK,CAAC4I,aAAN,CAAoC;AAChEC,EAAAA,WAAW,EAAE,MADmD;AAEhEC,EAAAA,SAAS,EAAE;AAFqD,CAApC,CAAvB;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ICOMC,aAAa,GAAG,SAAhBA,aAAgB;;;MAC3BjL,aAAAA;MACAC,eAAAA;MACAiL,iBAAAA;MACAhK,iBAAAA;MACAiK,qBAAAA;MACAC,aAAAA;MACA5I,cAAAA;AAEA,MAAM6I,GAAG,GAAGlL,MAAM,CAAmB,IAAnB,CAAlB;AAEAC,EAAAA,SAAS,CAAC;AACR,QAAMO,EAAE,GAAG0K,GAAG,CAAChL,OAAf;;AACA,QAAI,CAACM,EAAL,EAAS;AACP;AACD;;AACDA,IAAAA,EAAE,CAACkH,KAAH,GAAW,IAAX;AACA7H,IAAAA,KAAK,CAACM,MAAN,CAAaK,EAAb;AACA,WAAO;AACLX,MAAAA,KAAK,CAACS,MAAN,CAAaE,EAAb;AACD,KAFD;AAGD,GAVQ,EAUN,CAACX,KAAD,EAAQqL,GAAR,CAVM,CAAT;AAYA,MAAMC,YAAY,GAAGvH,WAAW,CAAC,UAACwH,EAAD;AAC/B,QAAIA,EAAE,CAACC,MAAH,YAAqBC,gBAAzB,EAA2C;AACzC,UAAIN,aAAJ,EAAmB;AACjBA,QAAAA,aAAa,CAACI,EAAE,CAACC,MAAH,CAAUE,UAAX,EAAuBH,EAAE,CAACC,MAAH,CAAUG,WAAjC,CAAb;AACD;AACF;AACF,GAN+B,EAM7B,EAN6B,CAAhC;AAQAvL,EAAAA,SAAS,CAAC;AACR,QAAMO,EAAE,GAAG0K,GAAG,CAAChL,OAAf;;AACA,QAAIM,EAAJ,EAAQ;AACNA,MAAAA,EAAE,CAAC0D,gBAAH,CAAoB,QAApB,EAA8BiH,YAA9B;AACD;;AACD,WAAO;AACL3K,MAAAA,EAAE,SAAF,IAAAA,EAAE,WAAF,YAAAA,EAAE,CAAE2D,mBAAJ,CAAwB,QAAxB,EAAkCgH,YAAlC;AACD,KAFD;AAGD,GARQ,EAQN,CAACD,GAAD,CARM,CAAT;AAUA,MAAMO,aAAa,GACjB3L,OAAO,IACP,0BAAAD,KAAK,CAAC6L,gBAAN,gFAAwBC,WAAxB,GAAsCC,UAAtC,MAAqD,aAFvD;AAGA,MAAMC,KAAK,GAAkB;AAC3BC,IAAAA,SAAS,EAAEhM,OAAO,IAAI2L,aAAX,GAA2B,iBAA3B,GAA+C,EAD/B;AAE3BR,IAAAA,KAAK,EAAEA,KAFoB;AAG3B5I,IAAAA,MAAM,EAAEA;AAHmB,GAA7B;;AAKA,MAAI0I,SAAJ,EAAe;AACbc,IAAAA,KAAK,CAACd,SAAN,GAAkBA,SAAlB;AACD;;AAED,SACEhJ,4BAAA,QAAA;AAAOmJ,IAAAA,GAAG,EAAEA;AAAKnK,IAAAA,SAAS,EAAEA,SAAF,WAAEA,SAAF,GAAeU,MAAM,CAACsK;AAAOF,IAAAA,KAAK,EAAEA;GAA9D,CADF;AAGD,CAxDM;;ICwCMG,eAAe,GAAG,SAAlBA,eAAkB;MAC7BrH,mBAAAA;MACAsG,aAAAA;MACA5I,cAAAA;MACAtB,iBAAAA;MACAkL,wBAAAA;MACAC,mBAAAA;MACAC,oBAAAA;MACAC,mBAAAA;MACAC,mBAAAA;MACAC,mBAAAA;MACAC,6BAAAA;MACAC,oBAAAA;MACAC,oBAAAA;MACA5L,eAAAA;;AAEA,wBACE6D,cAAc,CAACC,WAAD,CADhB;AAAA,MAAQkD,iBAAR,mBAAQA,iBAAR;AAAA,MAA2B/H,OAA3B,mBAA2BA,OAA3B;AAAA,MAAoCiF,iBAApC,mBAAoCA,iBAApC;AAAA,MAAuDE,UAAvD,mBAAuDA,UAAvD;;AAEA,kBAAkC5D,QAAQ,EAA1C;AAAA,MAAOqL,SAAP;AAAA,MAAkBC,YAAlB;;AACA,mBAA4CtL,QAAQ,EAApD;AAAA,MAAOuL,cAAP;AAAA,MAAuBC,iBAAvB;;AACA,MAAMC,OAAO,GAAGC,UAAU,CAACrC,cAAD,CAA1B;AAEA,MAAMS,YAAY,GAAGvH,WAAW,CAAC,UAACqH,KAAD,EAAgB5I,MAAhB;AAC/BsK,IAAAA,YAAY,CAAI1B,KAAJ,SAAa5I,MAAb,CAAZ;AACD,GAF+B,EAE7B,EAF6B,CAAhC;AAIApC,EAAAA,SAAS,CAAC;AACR,QAAM+M,QAAQ,GAAGC,WAAW,CAAC;AAC3B,UAAIC,KAAK,GAAG,CAAZ;AACAvI,MAAAA,WAAW,CAACiB,MAAZ,CAAmBrF,OAAnB,CAA2B,UAACwF,GAAD;AACzB,YACEA,GAAG,CAAClG,KAAJ,YAAqBsN,UAArB,IACApH,GAAG,CAAClG,KAAJ,YAAqBuN,WAFvB,EAGE;AACAF,UAAAA,KAAK,IAAInH,GAAG,CAAClG,KAAJ,CAAU+M,cAAnB;AACD;AACF,OAPD;AAQAC,MAAAA,iBAAiB,CAACK,KAAD,CAAjB;AACD,KAX2B,EAWzB,IAXyB,CAA5B;AAYA,WAAO;AACLG,MAAAA,aAAa,CAACL,QAAD,CAAb;AACD,KAFD;AAGD,GAhBQ,EAgBN,EAhBM,CAAT;AAkBA,MAAMM,eAAe,GAAkB;AACrCrC,IAAAA,KAAK,EAAEA,KAD8B;AAErC5I,IAAAA,MAAM,EAAEA;AAF6B,GAAvC;AAMA,MAAI0I,SAAS,GAAuB,SAApC;AACA,MAAIwC,gBAAJ;;AACA,MAAI,CAACnB,WAAD,IAAgBF,WAAhB,IAA+BC,YAAnC,EAAiD;AAC/CC,IAAAA,WAAW,GAAGF,WAAW,GAAGC,YAAd,GAA6B,WAA7B,GAA2C,UAAzD;AACD;;AACD,MAAItE,iBAAJ,aAAIA,iBAAJ,eAAIA,iBAAiB,CAAE2F,UAAvB,EAAmC;AACjCD,IAAAA,gBAAgB,GACd1F,iBAAiB,CAAC2F,UAAlB,CAA6BvC,KAA7B,GAAqCpD,iBAAiB,CAAC2F,UAAlB,CAA6BnL,MAAlE,GACI,WADJ,GAEI,UAHN;AAID;;AAED,MAAIkL,gBAAgB,KAAKnB,WAAzB,EAAsC;AACpCrB,IAAAA,SAAS,GAAG,OAAZ;AACD;;AAED,MAAI,CAACsB,WAAL,EAAkB;AAChBA,IAAAA,WAAW,GAAG1H,WAAW,CAAC8I,IAAZ,IAAoB9I,WAAW,CAAC+I,QAA9C;;AACA,QAAI5N,OAAJ,EAAa;AACXuM,MAAAA,WAAW,IAAI,QAAf;AACD;AACF;;AAED,MAAIsB,WAAJ;;AACA,MACE9F,iBAAiB,SAAjB,IAAAA,iBAAiB,WAAjB,IAAAA,iBAAiB,CAAE7B,YAAnB,IACA6B,iBADA,aACAA,iBADA,eACAA,iBAAiB,CAAEhI,KADnB,IAEA,EAACgI,iBAAD,aAACA,iBAAD,eAACA,iBAAiB,CAAE1E,OAApB,CAHF,EAIE;AACAwK,IAAAA,WAAW,GACT5L,4BAAA,CAAC+I,aAAD;AACEjL,MAAAA,KAAK,EAAEgI,iBAAiB,CAAChI;AACzBC,MAAAA,OAAO,EAAEA;AACTiL,MAAAA,SAAS,EAAEA;AACXE,MAAAA,KAAK,EAAC;AACN5I,MAAAA,MAAM,EAAC;AACP2I,MAAAA,aAAa,EAAEG;KANjB,CADF;AAUD,GAfD,MAeO;AACLwC,IAAAA,WAAW,GAAG5L,4BAAA,MAAA;AAAKhB,MAAAA,SAAS,EAAEU,MAAM,CAACmM;KAAvB,CAAd;AACD;;AAED,MAAMpM,OAAO,GAAG,CAACC,MAAM,CAACkD,WAAR,CAAhB;;AACA,MAAI5D,SAAJ,EAAe;AACbS,IAAAA,OAAO,CAACqM,IAAR,CAAa9M,SAAb;AACD;;AACD,MAAIkE,UAAJ,EAAgB;AACdzD,IAAAA,OAAO,CAACqM,IAAR,CAAa5B,gBAAb,WAAaA,gBAAb,GAAiCxK,MAAM,CAACqM,OAAxC;AACD;;AACD,MAAMlJ,YAAY,GAAG,CAACD,WAAW,CAAC6E,mBAAlC;AAGA,MAAIuE,YAAJ;;AACA,MAAIjB,OAAO,CAACjC,SAAZ,EAAuB;AACrBkD,IAAAA,YAAY,GACVhM,4BAAA,MAAA;AAAKhB,MAAAA,SAAS,EAAEU,MAAM,CAACuM;KAAvB,EACEjM,4BAAA,OAAA,MAAA,EAAO2K,SAAP,CADF,EAEGE,cAAc,KAAK3G,SAAnB,IAAgC2G,cAAc,GAAG,CAAjD,IACC7K,4BAAA,OAAA,MAAA,QAAA,EAAakM,IAAI,CAACC,KAAL,CAAWtB,cAAc,GAAG,IAA5B,CAAb,SAAA,CAHJ,CADF;AAQD;;AAED,MAAIuB,0BAAJ;;AACA,MAAI5B,qBAAJ,EAA2B;AACzB,YAAQxH,iBAAR;AACE,WAAKqJ,iBAAiB,CAACC,SAAvB;AACEF,QAAAA,0BAA0B,GAAGG,qBAA7B;AACA;;AACF,WAAKF,iBAAiB,CAACG,IAAvB;AACEJ,QAAAA,0BAA0B,GAAGK,qBAA7B;AACA;;AACF,WAAKJ,iBAAiB,CAACK,IAAvB;AACEN,QAAAA,0BAA0B,GAAGO,qBAA7B;AACA;AATJ;AAWD;;AAED,SACE3M,4BAAA,MAAA;AACEhB,IAAAA,SAAS,EAAES,OAAO,CAACmN,IAAR,CAAa,GAAb;AACX9C,IAAAA,KAAK,EAAEyB;AACPd,IAAAA,YAAY,EAAEA;AACdC,IAAAA,YAAY,EAAEA;AACd5L,IAAAA,OAAO,EAAEA;GALX,EAOGqL,WAAW,IAAIC,YAAf,IACCpK,4BAAA,CAAC6M,WAAD;AAAaC,IAAAA,KAAK,EAAE3C,WAAW,GAAGC;GAAlC,EACGwB,WADH,CARJ,EAYG,CAAC,CAACzB,WAAD,IAAgB,CAACC,YAAlB,KAAmCwB,WAZtC,EAcG,CAACrB,WAAW,IAAIQ,OAAO,CAACjC,SAAxB,KACC9I,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,MAAM,CAACqN;GAAvB,EACE/M,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,MAAM,CAACgM;GAAvB,EAA8BpB,WAA9B,CADF,EAEEtK,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,MAAM,CAACsN;GAAvB,EAAgChB,YAAhC,CAFF,EAGEhM,4BAAA,MAAA,MAAA,EACGoM,0BAA0B,IAAIpM,4BAAA,CAACoM,0BAAD,MAAA,CADjC,CAHF,EAMEpM,4BAAA,MAAA,MAAA,EACEA,4BAAA,CAACK,eAAD;AACEtB,IAAAA,IAAI,EAAE8D,YAAY,GAAGJ,iBAAH,GAAuBC;AACzCpC,IAAAA,MAAM,EAAE;AACRtB,IAAAA,SAAS,EAAE6D,YAAY,GAAGnD,MAAM,CAACuN,OAAV,GAAoBvN,MAAM,CAACwN;GAHpD,CADF,CANF,CAfJ,CADF;AAiCD,CAnKM;;IC3CMC,eAAe,GAAG,SAAlBA,eAAkB;MAAGrP,aAAAA;MAAOoL,aAAAA;MAAO5I,cAAAA;AAC9C,SACEN,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,MAAM,CAAC0N;GAAvB,EACEpN,4BAAA,CAAC+I,aAAD;AACEjL,IAAAA,KAAK,EAAEA;AACPC,IAAAA,OAAO,EAAE;AACTmL,IAAAA,KAAK,EAAEA;AACP5I,IAAAA,MAAM,EAAEA;GAJV,CADF,CADF;AAUD,CAXM;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACLA,IAAM+M,SAAS,GAAG,SAAZA,SAAY;MACvBC,iBAAAA;MACAC,2BAAAA;MACAC,uBAAAA;MACAtG,eAAAA;AAEA,MAAQuG,YAAR,GAAoDH,SAApD,CAAQG,YAAR;AAAA,MAAsBC,KAAtB,GAAoDJ,SAApD,CAAsBI,KAAtB;AAAA,MAA6BC,YAA7B,GAAoDL,SAApD,CAA6BK,YAA7B;AAAA,MAA2C7G,IAA3C,GAAoDwG,SAApD,CAA2CxG,IAA3C;;AACA,kBAAsDxH,QAAQ,CAC5D,EAD4D,CAA9D;AAAA,MAAOsO,mBAAP;AAAA,MAA4BC,sBAA5B;;AAGA,mBAAsCvO,QAAQ,CAAC,KAAD,CAA9C;AAAA,MAAOiL,WAAP;AAAA,MAAoBuD,cAApB;;AACA,wBAAkC9N,cAAK,CAACV,QAAN,CAAeI,QAAM,CAACqO,OAAtB,CAAlC;AAAA,MAAOC,SAAP;AAAA,MAAkBC,YAAlB;;AAGA/P,EAAAA,SAAS,CAAC;;;AAER,QAAIgQ,UAAU,GAAG,CAAjB;;AACA,QAAIP,YAAY,CAAC1N,MAAb,KAAwB,CAA5B,EAA+B;AAC7BgO,MAAAA,YAAY,CAACvO,QAAM,CAACqO,OAAR,CAAZ;AACD,KAFD,MAEO,IAAIJ,YAAY,CAAC1N,MAAb,KAAwB,CAA5B,EAA+B;AACpCgO,MAAAA,YAAY,CAACvO,QAAM,CAACyO,OAAR,CAAZ;AACAD,MAAAA,UAAU,GAAG,CAAb;AACD,KAHM,MAGA,IAAIP,YAAY,CAAC1N,MAAb,IAAuB,CAA3B,EAA8B;AACnCgO,MAAAA,YAAY,CAACvO,QAAM,CAAC0O,OAAR,CAAZ;AACAF,MAAAA,UAAU,GAAGhC,IAAI,CAACmC,GAAL,CAASV,YAAY,CAAC1N,MAAtB,EAA8B,CAA9B,CAAb;AACD,KAHM,MAGA,IAAI0N,YAAY,CAAC1N,MAAb,IAAuB,CAA3B,EAA8B;AACnCgO,MAAAA,YAAY,CAACvO,QAAM,CAAC4O,OAAR,CAAZ;AACAJ,MAAAA,UAAU,GAAGhC,IAAI,CAACmC,GAAL,CAASV,YAAY,CAAC1N,MAAtB,EAA8B,CAA9B,CAAb;AACD,KAHM,MAGA,IAAI0N,YAAY,CAAC1N,MAAb,IAAuB,EAA3B,EAA+B;AACpCgO,MAAAA,YAAY,CAACvO,QAAM,CAAC6O,OAAR,CAAZ;AACAL,MAAAA,UAAU,GAAGhC,IAAI,CAACmC,GAAL,CAASV,YAAY,CAAC1N,MAAtB,EAA8B,EAA9B,CAAb;AACD,KAHM,MAGA;AACLgO,MAAAA,YAAY,CAACvO,QAAM,CAAC8O,OAAR,CAAZ;AACAN,MAAAA,UAAU,GAAGhC,IAAI,CAACmC,GAAL,CAASV,YAAY,CAAC1N,MAAtB,EAA8B,EAA9B,CAAb;AACD;;AAGD,QAAMwO,eAAe,GAAkB,EAAvC;AACAb,IAAAA,mBAAmB,CAACpP,OAApB,CAA4B,UAACkQ,CAAD;AAC1B,UACE5H,IAAI,SAAJ,IAAAA,IAAI,WAAJ,IAAAA,IAAI,CAAE6G,YAAN,CAAmBgB,GAAnB,CAAuBD,CAAC,CAACrQ,GAAzB,KACA,CAAAyI,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAEK,gBAAN,CAAuB9I,GAAvB,MAA+BqQ,CAAC,CAACrQ,GAFnC,EAGE;AACAoQ,QAAAA,eAAe,CAAC3C,IAAhB,CAAqB4C,CAArB;AACD;AACF,KAPD;AAUA5H,IAAAA,IAAI,SAAJ,IAAAA,IAAI,WAAJ,oCAAAA,IAAI,CAAE8H,cAAN,8EAAsBpQ,OAAtB,CAA8B,UAACuN,OAAD;AAC5B,UACE0C,eAAe,CAACI,QAAhB,CAAyB9C,OAAzB,KACCA,OAAO,MAAKjF,IAAL,aAAKA,IAAL,uBAAKA,IAAI,CAAEK,gBAAX,CAAP,IACC,EAACL,IAAD,aAACA,IAAD,eAACA,IAAI,CAAE6G,YAAN,CAAmBgB,GAAnB,CAAuB5C,OAAO,CAAC1N,GAA/B,CAAD,CAHJ,EAIE;AACA;AACD;;AAED,UAAMyQ,GAAG,GAAGL,eAAe,CAACM,SAAhB,CAA0B,UAACL,CAAD;AAAA,eAAO,CAACA,CAAC,CAACxL,UAAV;AAAA,OAA1B,CAAZ;;AACA,UAAI4L,GAAG,IAAI,CAAX,EAAc;AACZL,QAAAA,eAAe,CAACK,GAAD,CAAf,GAAuB/C,OAAvB;AACD,OAFD,MAEO;AACL0C,QAAAA,eAAe,CAAC3C,IAAhB,CAAqBC,OAArB;AACD;AACF,KAfD;;AAkBA,yDAAgB4B,YAAhB,wCAA8B;AAAA,UAAnBe,CAAmB;;AAC5B,UAAID,eAAe,CAACxO,MAAhB,IAA0BiO,UAA9B,EAA0C;AACxC;AACD;;AACD,UAAIO,eAAe,CAACI,QAAhB,CAAyBH,CAAzB,KAA+BA,CAAC,CAACxL,UAArC,EAAiD;AAC/C;AACD;;AACDuL,MAAAA,eAAe,CAAC3C,IAAhB,CAAqB4C,CAArB;AACD;;AAED,QAAID,eAAe,CAACxO,MAAhB,GAAyBiO,UAA7B,EAAyC;AACvCO,MAAAA,eAAe,CAACO,MAAhB,CAAuBd,UAAvB,EAAmCO,eAAe,CAACxO,MAAhB,GAAyBiO,UAA5D;AACD;;AACDL,IAAAA,sBAAsB,CAACY,eAAD,CAAtB;AACD,GAlEQ,EAkEN,CAACd,YAAD,CAlEM,CAAT;;AAoEA,MAAID,KAAJ,EAAW;AACT,WAAO1N,4BAAA,MAAA,MAAA,UAAA,EAAY0N,KAAK,CAACuB,OAAlB,CAAP;AACD;;AAED,MAAIxB,YAAJ,EAAkB;AAChB,WAAOzN,4BAAA,MAAA,MAAA,cAAA,CAAP;AACD;;AACD,MAAI,CAAC8G,IAAL,EAAW;AACT,WAAO9G,4BAAA,MAAA,MAAA,eAAA,CAAP;AACD;;AAED,MAAI2N,YAAY,CAAC1N,MAAb,KAAwB,CAA5B,EAA+B;AAC7B,WAAOD,4BAAA,MAAA,MAAA,yBAAA,CAAP;AACD;;AAED,MAAMkP,mBAAmB,GAAG3B,mBAAH,WAAGA,mBAAH,GAA0BtD,eAAnD;AACA,MAAMkF,eAAe,GAAG3B,eAAH,WAAGA,eAAH,GAAsB3G,YAA3C;AAEA,SAEE7G,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAAC0P;GAAvB,EACEpP,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAKU,QAAM,CAAC2P,SAAZ,SAAyBrB;GAAvC,EACGJ,mBAAmB,CAAClN,GAApB,CAAwB,UAACkC,WAAD;AACvB,WACE5C,4BAAA,CAACkP,mBAAD;AACEtO,MAAAA,GAAG,EAAEgC,WAAW,CAAC+I;AACjB/I,MAAAA,WAAW,EAAEA;AACbyH,MAAAA,WAAW,EAAC;AACZnB,MAAAA,KAAK,EAAC;AACN5I,MAAAA,MAAM,EAAC;AACPiK,MAAAA,WAAW,EAAEA;AACbC,MAAAA,qBAAqB;AACrBC,MAAAA,YAAY,EAAE;AAAA,eAAMqD,cAAc,CAAC,IAAD,CAApB;AAAA;AACdpD,MAAAA,YAAY,EAAE;AAAA,eAAMoD,cAAc,CAAC,KAAD,CAApB;AAAA;KAThB,CADF;AAaD,GAdA,CADH,CADF,EAkBE9N,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAAC4P;GAAvB,EACEtP,4BAAA,CAACmP,eAAD;AAAiBrI,IAAAA,IAAI,EAAEA;AAAMI,IAAAA,OAAO,EAAEA;GAAtC,CADF,CAlBF,CAFF;AAyBD,CA7HM;;SCGSqI,wBACd5B;AAEA,MAAM6B,kBAAkB,aAAO7B,YAAP,CAAxB;AACA6B,EAAAA,kBAAkB,CAACC,IAAnB,CAAwB,UAACC,CAAD,EAAIC,CAAJ;;;AAEtB,QAAID,CAAC,CAACxM,UAAF,IAAgByM,CAAC,CAACzM,UAAtB,EAAkC;AAChC,aAAOyM,CAAC,CAACC,UAAF,GAAeF,CAAC,CAACE,UAAxB;AACD;;AAGD,QAAIF,CAAC,CAACxM,UAAF,KAAiByM,CAAC,CAACzM,UAAvB,EAAmC;AACjC,UAAIwM,CAAC,CAACxM,UAAN,EAAkB;AAChB,eAAO,CAAC,CAAR;AACD,OAFD,MAEO;AACL,eAAO,CAAP;AACD;AACF;;AAGD,QAAIwM,CAAC,CAACG,WAAF,KAAkBF,CAAC,CAACE,WAAxB,EAAqC;AAAA;;AACnC,UAAMC,KAAK,8CAAGJ,CAAC,CAACG,WAAL,mDAAG,eAAeE,OAAf,EAAH,oCAA+B,CAA1C;AACA,UAAMC,KAAK,8CAAGL,CAAC,CAACE,WAAL,mDAAG,eAAeE,OAAf,EAAH,oCAA+B,CAA1C;AACA,aAAOC,KAAK,GAAGF,KAAf;AACD;;AAGD,QAAMG,MAAM,GAAGP,CAAC,CAACQ,WAAF,CAAcC,IAAd,GAAqB,CAApC;AACA,QAAMC,MAAM,GAAGT,CAAC,CAACO,WAAF,CAAcC,IAAd,GAAqB,CAApC;;AACA,QAAIF,MAAM,KAAKG,MAAf,EAAuB;AACrB,UAAIH,MAAJ,EAAY;AACV,eAAO,CAAC,CAAR;AACD,OAFD,MAEO;AACL,eAAO,CAAP;AACD;AACF;;AAGD,WAAO,uCAACP,CAAC,CAACW,QAAH,gDAAC,YAAYN,OAAZ,EAAD,kCAA0B,CAA1B,2CAAgCJ,CAAC,CAACU,QAAlC,gDAAgC,YAAYN,OAAZ,EAAhC,kCAAyD,CAAzD,CAAP;AACD,GAnCD;AAoCA,MAAM5I,gBAAgB,GAAGqI,kBAAkB,CAACjN,IAAnB,CACvB,UAACmM,CAAD;AAAA,WAAOA,CAAC,YAAY7I,gBAApB;AAAA,GADuB,CAAzB;;AAGA,MAAIsB,gBAAJ,EAAsB;AACpB,QAAMmJ,QAAQ,GAAGd,kBAAkB,CAACe,OAAnB,CAA2BpJ,gBAA3B,CAAjB;;AACA,QAAImJ,QAAQ,IAAI,CAAhB,EAAmB;AACjBd,MAAAA,kBAAkB,CAACR,MAAnB,CAA0BsB,QAA1B,EAAoC,CAApC;;AACA,UAAId,kBAAkB,CAACvP,MAAnB,GAA4B,CAAhC,EAAmC;AACjCuP,QAAAA,kBAAkB,CAACR,MAAnB,CAA0B,CAA1B,EAA6B,CAA7B,EAAgC7H,gBAAhC;AACD,OAFD,MAEO;AACLqI,QAAAA,kBAAkB,CAAC1D,IAAnB,CAAwB3E,gBAAxB;AACD;AACF;AACF;;AACD,SAAOqI,kBAAP;AACD;;ACxDM,IAAMgB,YAAY,GAAG,SAAfA,YAAe;MAC1BlD,iBAAAA;MACAC,2BAAAA;MACAC,uBAAAA;MACAtG,eAAAA;MACAuJ,wBAAAA;AAEA,MAAQhD,YAAR,GAAoDH,SAApD,CAAQG,YAAR;AAAA,MAAsBC,KAAtB,GAAoDJ,SAApD,CAAsBI,KAAtB;AAAA,MAA6BC,YAA7B,GAAoDL,SAApD,CAA6BK,YAA7B;AAAA,MAA2C7G,IAA3C,GAAoDwG,SAApD,CAA2CxG,IAA3C;;AACA,kBAAsCxH,QAAQ,CAAC,KAAD,CAA9C;AAAA,MAAOiL,WAAP;AAAA,MAAoBuD,cAApB;;AACA,MAAM4C,MAAM,GAAGD,gBAAH,WAAGA,gBAAH,GAAuBlB,uBAAnC;;AACA,mBAAoDjQ,QAAQ,CAC1DoR,MAAM,CAAC/C,YAAD,CADoD,CAA5D;AAAA,MAAO6B,kBAAP;AAAA,MAA2BmB,qBAA3B;;AAIAzS,EAAAA,SAAS,CAAC;AACRyS,IAAAA,qBAAqB,CAACD,MAAM,CAAC/C,YAAD,CAAP,CAArB;AACD,GAFQ,EAEN,CAACA,YAAD,EAAe+C,MAAf,CAFM,CAAT;;AAIA,MAAIhD,KAAJ,EAAW;AACT,WAAO1N,4BAAA,MAAA,MAAA,UAAA,EAAY0N,KAAK,CAACuB,OAAlB,CAAP;AACD;;AAED,MAAIxB,YAAJ,EAAkB;AAChB,WAAOzN,4BAAA,MAAA,MAAA,cAAA,CAAP;AACD;;AACD,MAAI,CAAC8G,IAAL,EAAW;AACT,WAAO9G,4BAAA,MAAA,MAAA,eAAA,CAAP;AACD;;AAED,MAAIwP,kBAAkB,CAACvP,MAAnB,KAA8B,CAAlC,EAAqC;AACnC,WAAOD,4BAAA,MAAA,MAAA,yBAAA,CAAP;AACD;;AAED,MAAMkP,mBAAmB,GAAG3B,mBAAH,WAAGA,mBAAH,GAA0BtD,eAAnD;AACA,MAAMkF,eAAe,GAAG3B,eAAH,WAAGA,eAAH,GAAsB3G,YAA3C;AAGA,MAAI+J,WAAJ;AACApB,EAAAA,kBAAkB,CAAChR,OAAnB,CAA2B,UAACkQ,CAAD;AACzB,QAAIkC,WAAJ,EAAiB;AACf;AACD;;AACD,QAAM9S,KAAK,GAAG4Q,CAAC,CAAC3I,QAAF,CAAW1B,KAAK,CAAC2B,MAAN,CAAaK,WAAxB,CAAd;;AACA,QAAIvI,KAAK,SAAL,IAAAA,KAAK,WAAL,IAAAA,KAAK,CAAEmG,YAAP,IAAuBnG,KAAK,CAAC+S,UAAjC,EAA6C;AAC3CD,MAAAA,WAAW,GAAG9S,KAAK,CAAC+S,UAApB;AACD;AACF,GARD;AAUA,MAAMC,iBAAiB,GAAGtB,kBAA1B;AACA,MAAIuB,QAAJ;;AACA,MAAIH,WAAJ,EAAiB;AACfG,IAAAA,QAAQ,GACN/Q,4BAAA,CAACmN,eAAD;AAAiBrP,MAAAA,KAAK,EAAE8S;AAAatQ,MAAAA,MAAM,EAAC;AAAO4I,MAAAA,KAAK,EAAC;KAAzD,CADF;AAGD,GAJD,MAIO;AACL6H,IAAAA,QAAQ,GACN/Q,4BAAA,CAACkP,mBAAD;AACEtO,MAAAA,GAAG,EAAE4O,kBAAkB,CAAC,CAAD,CAAlB,CAAsB7D;AAC3B/I,MAAAA,WAAW,EAAE4M,kBAAkB,CAAC,CAAD;AAC/BtG,MAAAA,KAAK,EAAC;AACN5I,MAAAA,MAAM,EAAC;AACP+J,MAAAA,WAAW,EAAC;AACZE,MAAAA,WAAW,EAAEA;AACbC,MAAAA,qBAAqB;AACrBC,MAAAA,YAAY,EAAE;AAAA,eAAMqD,cAAc,CAAC,IAAD,CAApB;AAAA;AACdpD,MAAAA,YAAY,EAAE;AAAA,eAAMoD,cAAc,CAAC,KAAD,CAApB;AAAA;KAThB,CADF;AAaD;;AAED,SAEE9N,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAAC0P;GAAvB,EACEpP,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAACsR;GAAvB,EACEhR,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAACuR;GAAvB,EAAqCF,QAArC,CADF,EAEE/Q,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAACwR;GAAvB,EACGJ,iBAAiB,CAACpQ,GAAlB,CAAsB,UAACkC,WAAD;AACrB,WACE5C,4BAAA,CAACkP,mBAAD;AACEtO,MAAAA,GAAG,EAAEgC,WAAW,CAAC+I;AACjB/I,MAAAA,WAAW,EAAEA;AACbsG,MAAAA,KAAK,EAAC;AACNiB,MAAAA,WAAW,EAAE;AACbC,MAAAA,YAAY,EAAE;AACdG,MAAAA,WAAW,EAAEA;AACbE,MAAAA,YAAY,EAAE;AAAA,eAAMqD,cAAc,CAAC,IAAD,CAApB;AAAA;AACdpD,MAAAA,YAAY,EAAE;AAAA,eAAMoD,cAAc,CAAC,KAAD,CAApB;AAAA;KARhB,CADF;AAYD,GAbA,CADH,CAFF,CADF,EAoBE9N,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAAC4P;GAAvB,EACEtP,4BAAA,CAACmP,eAAD;AAAiBrI,IAAAA,IAAI,EAAEA;AAAMI,IAAAA,OAAO,EAAEA;GAAtC,CADF,CApBF,CAFF;AA2BD,CAjGM;;;;ACAA,IAAMiK,WAAW,GAAG,SAAdA,WAAc;MACzB7D,iBAAAA;MACAC,2BAAAA;MACAC,uBAAAA;MACAtG,eAAAA;MACAuJ,wBAAAA;AAEA,MAAQhD,YAAR,GAAoDH,SAApD,CAAQG,YAAR;AAAA,MAAsBC,KAAtB,GAAoDJ,SAApD,CAAsBI,KAAtB;AAAA,MAA6BC,YAA7B,GAAoDL,SAApD,CAA6BK,YAA7B;AAAA,MAA2C7G,IAA3C,GAAoDwG,SAApD,CAA2CxG,IAA3C;;AACA,kBAAsCxH,QAAQ,CAAC,KAAD,CAA9C;AAAA,MAAOiL,WAAP;AAAA,MAAoBuD,cAApB;;AACA,MAAM4C,MAAM,GAAGD,gBAAH,WAAGA,gBAAH,GAAuBlB,uBAAnC;;AACA,mBAAoDjQ,QAAQ,CAC1DoR,MAAM,CAAC/C,YAAD,CADoD,CAA5D;AAAA,MAAO6B,kBAAP;AAAA,MAA2BmB,qBAA3B;;AAIAzS,EAAAA,SAAS,CAAC;AACRyS,IAAAA,qBAAqB,CAACD,MAAM,CAAC/C,YAAD,CAAP,CAArB;AACD,GAFQ,EAEN,CAACA,YAAD,EAAe+C,MAAf,CAFM,CAAT;;AAIA,MAAIhD,KAAJ,EAAW;AACT,WAAO1N,4BAAA,MAAA,MAAA,UAAA,EAAY0N,KAAK,CAACuB,OAAlB,CAAP;AACD;;AAED,MAAIxB,YAAJ,EAAkB;AAChB,WAAOzN,4BAAA,MAAA,MAAA,cAAA,CAAP;AACD;;AACD,MAAI,CAAC8G,IAAL,EAAW;AACT,WAAO9G,4BAAA,MAAA,MAAA,eAAA,CAAP;AACD;;AAED,MAAIwP,kBAAkB,CAACvP,MAAnB,KAA8B,CAAlC,EAAqC;AACnC,WAAOD,4BAAA,MAAA,MAAA,yBAAA,CAAP;AACD;;AAED,MAAMkP,mBAAmB,GAAG3B,mBAAH,WAAGA,mBAAH,GAA0BtD,eAAnD;AACA,MAAMkF,eAAe,GAAG3B,eAAH,WAAGA,eAAH,GAAsB3G,YAA3C;AAGA,MAAI+J,WAAJ;AACApB,EAAAA,kBAAkB,CAAChR,OAAnB,CAA2B,UAACkQ,CAAD;AACzB,QAAIkC,WAAJ,EAAiB;AACf;AACD;;AACD,QAAM9S,KAAK,GAAG4Q,CAAC,CAAC3I,QAAF,CAAW1B,KAAK,CAAC2B,MAAN,CAAaK,WAAxB,CAAd;;AACA,QAAIvI,KAAK,SAAL,IAAAA,KAAK,WAAL,IAAAA,KAAK,CAAEmG,YAAP,IAAuBnG,KAAK,CAAC+S,UAAjC,EAA6C;AAC3CD,MAAAA,WAAW,GAAG9S,KAAK,CAAC+S,UAApB;AACD;AACF,GARD;AAUA,MAAMC,iBAAiB,GAAGtB,kBAA1B;AACA,MAAIuB,QAAJ;;AACA,MAAIH,WAAJ,EAAiB;AACfG,IAAAA,QAAQ,GACN/Q,4BAAA,CAACmN,eAAD;AAAiBrP,MAAAA,KAAK,EAAE8S;AAAatQ,MAAAA,MAAM,EAAC;AAAO4I,MAAAA,KAAK,EAAC;KAAzD,CADF;AAGD,GAJD,MAIO;AACL6H,IAAAA,QAAQ,GACN/Q,4BAAA,CAACkP,mBAAD;AACEtO,MAAAA,GAAG,EAAE4O,kBAAkB,CAAC,CAAD,CAAlB,CAAsB7D;AAC3B/I,MAAAA,WAAW,EAAE4M,kBAAkB,CAAC,CAAD;AAC/BjF,MAAAA,WAAW,EAAEA;AACbrB,MAAAA,KAAK,EAAC;AACN5I,MAAAA,MAAM,EAAC;AACP+J,MAAAA,WAAW,EAAC;AACZG,MAAAA,qBAAqB;AACrBC,MAAAA,YAAY,EAAE;AAAA,eAAMqD,cAAc,CAAC,IAAD,CAApB;AAAA;AACdpD,MAAAA,YAAY,EAAE;AAAA,eAAMoD,cAAc,CAAC,KAAD,CAApB;AAAA;KAThB,CADF;AAaD;;AAED,SAEE9N,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAAC0P;GAAvB,EACEpP,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAACsR;GAAvB,EAA+BD,QAA/B,CADF,EAEE/Q,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAAC0R;GAAvB,EACGN,iBAAiB,CAACpQ,GAAlB,CAAsB,UAACkC,WAAD;AACrB,WACE5C,4BAAA,CAACkP,mBAAD;AACEtO,MAAAA,GAAG,EAAEgC,WAAW,CAAC+I;AACjB/I,MAAAA,WAAW,EAAEA;AACb5D,MAAAA,SAAS,EAAEU,QAAM,CAACkD;AAClBuH,MAAAA,WAAW,EAAE;AACbC,MAAAA,YAAY,EAAE;AACdG,MAAAA,WAAW,EAAEA;AACbE,MAAAA,YAAY,EAAE;AAAA,eAAMqD,cAAc,CAAC,IAAD,CAApB;AAAA;AACdpD,MAAAA,YAAY,EAAE;AAAA,eAAMoD,cAAc,CAAC,KAAD,CAApB;AAAA;KARhB,CADF;AAYD,GAbA,CADH,CAFF,EAkBE9N,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,QAAM,CAAC4P;GAAvB,EACEtP,4BAAA,CAACmP,eAAD;AACErI,IAAAA,IAAI,EAAEA;AACNC,IAAAA,iBAAiB,EAAE;AACnBG,IAAAA,OAAO,EAAEA;GAHX,CADF,CAlBF,CAFF;AA6BD,CAnGM;;ICIMmK,SAAS,GAAG,SAAZA,SAAY,CAACC,UAAD;AACvB,MAAMC,QAAQ,GAAGC,aAAa,CAAC;AAAEC,IAAAA,KAAK,EAAE;AAAT,GAAD,CAA9B;AACA,8BAA+BH,UAAU,CAAChE,SAA1C;AAAA,MAAQxG,IAAR,yBAAQA,IAAR;AAAA,MAAc6G,YAAd,yBAAcA,YAAd;AACA,MAAM5C,OAAO,GAAGC,UAAU,CAACrC,cAAD,CAA1B;AAEA,MAAIiD,WAAJ;;AACA,MAAI2F,QAAJ,EAAc;AACZ3F,IAAAA,WAAW,GAAG5L,4BAAA,CAACmR,WAAD,oBAAiBG,WAAjB,CAAd;AACD,GAFD,MAEO;AAEL,QAAIV,WAAJ;AACAjD,IAAAA,YAAY,CAACnP,OAAb,CAAqB,UAACkQ,CAAD;AACnB,UAAIkC,WAAJ,EAAiB;AACf;AACD;;AACD,UAAM9S,KAAK,GAAG4Q,CAAC,CAAC3I,QAAF,CAAW1B,KAAK,CAAC2B,MAAN,CAAaK,WAAxB,CAAd;;AACA,UAAIvI,KAAK,SAAL,IAAAA,KAAK,WAAL,IAAAA,KAAK,CAAEmG,YAAP,IAAuBnG,KAAK,CAAC+S,UAAjC,EAA6C;AAC3CD,QAAAA,WAAW,GAAG9S,KAAK,CAAC+S,UAApB;AACD;AACF,KARD;;AAUA,QAAI9F,OAAO,CAAClC,WAAR,KAAwB,MAAxB,IAAkC+H,WAAW,KAAK1M,SAAtD,EAAiE;AAC/D0H,MAAAA,WAAW,GAAG5L,4BAAA,CAACqN,SAAD,oBAAeiE,WAAf,CAAd;AACD,KAFD,MAEO;AACL1F,MAAAA,WAAW,GAAG5L,4BAAA,CAACwQ,YAAD,oBAAkBc,WAAlB,CAAd;AACD;AACF;;AAED,SACEtR,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,MAAM,CAAC0P;GAAvB,EACGxD,WADH,EAEG0F,UAAU,CAAChE,SAAX,CAAqB1H,WAArB,CAAiClF,GAAjC,CAAqC,UAAC5C,KAAD;AAAA,WACpCkC,4BAAA,CAACnC,aAAD;AAAe+C,MAAAA,GAAG,EAAE9C,KAAK,CAACO;AAAKP,MAAAA,KAAK,EAAEA;AAAOC,MAAAA,OAAO,EAAE;KAAtD,CADoC;AAAA,GAArC,CAFH,EAMG,CAAA+I,IAAI,SAAJ,IAAAA,IAAI,WAAJ,YAAAA,IAAI,CAAE4K,gBAAN,MAA2B,KAA3B,IACC1R,4BAAA,MAAA;AAAKhB,IAAAA,SAAS,EAAEU,MAAM,CAACiS;GAAvB,EACE3R,4BAAA,SAAA;AACEhB,IAAAA,SAAS,EAAEU,MAAM,CAACkS;AAClB9S,IAAAA,OAAO,EAAE;AACPgI,MAAAA,IAAI,CAAC+K,UAAL;AACD;GAJH,EAME7R,4BAAA,CAACK,eAAD;AACErB,IAAAA,SAAS,EAAEU,MAAM,CAACX;AAClBoR,IAAAA,IAAI,EAAC;AACLpR,IAAAA,IAAI,EAAE+S;GAHR,CANF,mBAAA,CADF,CAPJ,CADF;AA0BD,CAtDM;;ACbP;AACA,AAkKA;AACA,AAAO,MAAM,eAAe,iBAAiB,OAAO,MAAM,KAAK,WAAW,IAAI,MAAM,CAAC,QAAQ,KAAK,MAAM,CAAC,QAAQ,GAAG,MAAM,CAAC,iBAAiB,CAAC,CAAC,IAAI,YAAY,CAAC;AAC/J,AA2DA;AACA,AAAO,MAAM,oBAAoB,iBAAiB,OAAO,MAAM,KAAK,WAAW,IAAI,MAAM,CAAC,aAAa,KAAK,MAAM,CAAC,aAAa,GAAG,MAAM,CAAC,sBAAsB,CAAC,CAAC,IAAI,iBAAiB,CAAC;AACxL,AA8UA;AACA;AACA,AAAO,SAAS,MAAM,CAAC,IAAI,EAAE,OAAO,EAAE;AACtC,CAAC,IAAI;AACL,EAAE,IAAI,MAAM,GAAG,IAAI,EAAE,CAAC;AACtB,EAAE,CAAC,MAAM,CAAC,EAAE;AACZ,EAAE,OAAO,OAAO,CAAC,CAAC,CAAC,CAAC;AACpB,EAAE;AACF,CAAC,IAAI,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE;AAC5B,EAAE,OAAO,MAAM,CAAC,IAAI,CAAC,KAAK,CAAC,EAAE,OAAO,CAAC,CAAC;AACtC,EAAE;AACF,CAAC,OAAO,MAAM,CAAC;AACf,CAAC;;SCjiBeC,QAAQC;AACtB,kBAAsC1S,QAAQ,EAA9C;AAAA,MAAO2S,WAAP;AAAA,MAAoBC,cAApB;;AACA,mBAAwC5S,QAAQ,CAAC,KAAD,CAAhD;AAAA,MAAOmO,YAAP;AAAA,MAAqB0E,eAArB;;AACA,mBAA0B7S,QAAQ,EAAlC;AAAA,MAAOoO,KAAP;AAAA,MAAc0E,QAAd;;AACA,mBAAwC9S,QAAQ,CAAgB,EAAhB,CAAhD;AAAA,MAAOqO,YAAP;AAAA,MAAqB0E,eAArB;;AACA,mBAAsC/S,QAAQ,CAAe,EAAf,CAA9C;AAAA,MAAOsG,WAAP;AAAA,MAAoB0M,cAApB;;AAEA,MAAMC,SAAS,GAAG1Q,WAAW,WACpB2Q,GADoB,EACPC,KADO,EACQC,OADR;AAAA;AAEzBP,MAAAA,eAAe,CAAC,IAAD,CAAf;gDACI;AACF,YAAMrL,IAAI,GAAG,IAAIhF,IAAJ,CAASkQ,WAAT,CAAb;AADE,+BAEIlL,IAAI,CAAC6L,OAAL,CAAaH,GAAb,EAAkBC,KAAlB,EAAyBC,OAAzB,CAFJ;AAGFR,UAAAA,cAAc,CAACpL,IAAD,CAAd;;AACA,cAAM8L,qBAAqB,GAAG,SAAxBA,qBAAwB;AAC5B,gBAAMC,OAAO,GAAGlP,KAAK,CAACC,IAAN,CAAWkD,IAAI,CAAC6G,YAAL,CAAkB7J,MAAlB,EAAX,CAAhB;AACA,gBAAM6J,YAAY,GAAkB,CAAC7G,IAAI,CAACK,gBAAN,CAApC;AACAwG,YAAAA,YAAY,CAAC7B,IAAb,OAAA6B,YAAY,EAASkF,OAAT,CAAZ;AACAR,YAAAA,eAAe,CAAC1E,YAAD,CAAf;AACD,WALD;;AAMA,cAAMmF,wBAAwB,GAAG,SAA3BA,wBAA2B,CAAChV,KAAD;AAE/B8U,YAAAA,qBAAqB;;AACrB,gBAAI9U,KAAK,IAAIA,KAAK,CAACsG,IAAN,KAAeC,KAAK,CAACC,IAAN,CAAWC,KAAvC,EAA8C;AAC5C;AACD;;AACD,gBAAMV,MAAM,GAAiB,EAA7B;AACAiD,YAAAA,IAAI,CAAC6G,YAAL,CAAkBnP,OAAlB,CAA0B,UAACkQ,CAAD;AACxBA,cAAAA,CAAC,CAAC9I,WAAF,CAAcpH,OAAd,CAAsB,UAACwF,GAAD;AACpB,oBAAIA,GAAG,CAAC+O,UAAR,EAAoB;AAClBlP,kBAAAA,MAAM,CAACiI,IAAP,CAAY9H,GAAG,CAAC+O,UAAhB;AACD;AACF,eAJD;AAKD,aAND;AAOAT,YAAAA,cAAc,CAACzO,MAAD,CAAd;AACD,WAfD;;AAiBAiD,UAAAA,IAAI,CAACkM,IAAL,CAAUC,SAAS,CAACC,YAApB,EAAkC;AAChCC,YAAAA,UAAU,CAAC;AAAA,qBAAMjB,cAAc,CAAChO,SAAD,CAApB;AAAA,aAAD,CAAV;AAEA4C,YAAAA,IAAI,CACDpB,GADH,CACOuN,SAAS,CAACG,oBADjB,EACuCR,qBADvC,EAEGlN,GAFH,CAEOuN,SAAS,CAACI,uBAFjB,EAE0CT,qBAF1C,EAGGlN,GAHH,CAGOuN,SAAS,CAACK,qBAHjB,EAGwCV,qBAHxC,EAIGlN,GAJH,CAIOuN,SAAS,CAAC5N,eAJjB,EAIkCyN,wBAJlC,EAKGpN,GALH,CAKOuN,SAAS,CAAC3N,iBALjB,EAKoCwN,wBALpC,EAMGpN,GANH,CAMOuN,SAAS,CAAC1N,mBANjB,EAMsCqN,qBANtC,EAOGlN,GAPH,CAOOuN,SAAS,CAACzN,qBAPjB,EAOwCoN,qBAPxC,EAQGlN,GARH,CAQOuN,SAAS,CAACM,0BARjB,EAQ6CX,qBAR7C;AASD,WAZD;AAaA9L,UAAAA,IAAI,CACDjC,EADH,CACMoO,SAAS,CAACG,oBADhB,EACsCR,qBADtC,EAEG/N,EAFH,CAEMoO,SAAS,CAACI,uBAFhB,EAEyCT,qBAFzC,EAGG/N,EAHH,CAGMoO,SAAS,CAACK,qBAHhB,EAGuCV,qBAHvC,EAIG/N,EAJH,CAIMoO,SAAS,CAAC5N,eAJhB,EAIiCyN,wBAJjC,EAKGjO,EALH,CAKMoO,SAAS,CAAC3N,iBALhB,EAKmCwN,wBALnC,EAMGjO,EANH,CAMMoO,SAAS,CAAC1N,mBANhB,EAMqCqN,qBANrC,EAOG/N,EAPH,CAOMoO,SAAS,CAACzN,qBAPhB,EAOuCoN,qBAPvC,EASG/N,EATH,CASMoO,SAAS,CAACM,0BAThB,EAS4CX,qBAT5C;AAWAT,UAAAA,eAAe,CAAC,KAAD,CAAf;AACAW,UAAAA,wBAAwB;AAExB,iBAAOhM,IAAP;AAtDE;AAuDH,mBAAQ4G,OAAO;AACdyE,QAAAA,eAAe,CAAC,KAAD,CAAf;;AACA,YAAIzE,KAAK,YAAY8F,KAArB,EAA4B;AAC1BpB,UAAAA,QAAQ,CAAC1E,KAAD,CAAR;AACD,SAFD,MAEO;AACL0E,UAAAA,QAAQ,CAAC,IAAIoB,KAAJ,CAAU,sBAAV,CAAD,CAAR;AACD;;AAED,eAAOtP,SAAP;AACD;AACF,KApE0B;AAAA;AAAA;AAAA,KAqE3B,EArE2B,CAA7B;AAwEA,SAAO;AACLyO,IAAAA,OAAO,EAAEJ,SADJ;AAEL9E,IAAAA,YAAY,EAAZA,YAFK;AAGL3G,IAAAA,IAAI,EAAEmL,WAHD;AAILvE,IAAAA,KAAK,EAALA,KAJK;AAKLC,IAAAA,YAAY,EAAZA,YALK;AAML/H,IAAAA,WAAW,EAAXA;AANK,GAAP;AAQD;;IC5FY6N,WAAW,GAAG,SAAdA,WAAc;MACzBjB,WAAAA;MACAC,aAAAA;MACAT,mBAAAA;MACA0B,sBAAAA;MACAC,qBAAAA;MACApG,2BAAAA;MACAC,uBAAAA;MACAoG,mBAAAA;MACA1M,eAAAA;AAEA,MAAMoG,SAAS,GAAGyE,OAAO,CAACC,WAAD,CAAzB;AAEA9T,EAAAA,SAAS,CAAC;AACRoP,IAAAA,SAAS,CAACqF,OAAV,CAAkBH,GAAlB,EAAuBC,KAAvB,EAA8BiB,cAA9B,EAA8CG,IAA9C,CAAmD,UAAC/M,IAAD;AACjD,UAAI,CAACA,IAAL,EAAW;AACT;AACD;;AACD,UAAI8M,WAAJ,EAAiB;AACfA,QAAAA,WAAW,CAAC9M,IAAD,CAAX;AACD;AACF,KAPD;AAQD,GATQ,EASN,EATM,CAAT;AAWA,MAAMgN,qBAAqB,GAAGH,aAAH,WAAGA,aAAH,GAAoBtC,SAA/C;AAEA,SAAOyC,qBAAqB,CAAC;AAC3BxG,IAAAA,SAAS,EAATA,SAD2B;AAE3BC,IAAAA,mBAAmB,EAAnBA,mBAF2B;AAG3BC,IAAAA,eAAe,EAAfA,eAH2B;AAI3BtG,IAAAA,OAAO,EAAPA;AAJ2B,GAAD,CAA5B;AAMD,CAhCM;;;;"}